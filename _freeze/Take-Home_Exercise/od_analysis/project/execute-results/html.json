{
  "hash": "8b68ca724fbd4924f3436e5ff1b5395a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"OD Component for Project: Prototyping Modules for Geospatial Analytics Shiny Application\"\ndate: \"October 27, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  freeze: true\n---\n\n\n\n\n### R Packages Used\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, sp, tidyverse, tmap, spatstat, spdep, leaflet, ggthemes, performance, data.table, reshape2, ggpubr, DT, stplanr, kableExtra, RColorBrewer, dplyr,tidyr, gridExtra, circlize, forcats, viridis)\n```\n:::\n\n\n\n\n## Data\n\n### Aspatial Data\n\n1.  Category Mapping for POI\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npoi_category <- read_csv(\"data/aspatial/mapping_poi/category_mapping.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 205 Columns: 2\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): value, category\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n\n2.  Trips Data\n\n-   Inclusive of Origin & Destination\n-   Time Cluster\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrips <- readRDS(\"data/rds/trip_data.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_trips <- st_as_sf(trips, coords = c(\"origin_lng\", \"origin_lat\"), crs = 4326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndestination_trips <- st_as_sf(trips, coords = c(\"destination_lng\", \"destination_lat\"), crs=4326)\n```\n:::\n\n\n\n\n### Geospatial Data\n\n#### 1. Jakarta Districts\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_district <- read_rds(\"data/rds/jakarta_district.rds\")\n```\n:::\n\n\n\n\nCalculation of Centroid\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_district_centroid <- jakarta_district %>%\n  mutate(\n    centroid = st_centroid(geometry),\n    centroid_lat = st_coordinates(centroid)[, 2],\n    centroid_lng = st_coordinates(centroid)[, 1]\n )\n\njakarta_district_centroid$district <- str_to_title(jakarta_district_centroid$district)\n```\n:::\n\n\n\n\nWe save this in RDS\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(jakarta_district_centroid, \"data/rds/jakarta_district_centroid.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_district_centroid <- read_rds(\"data/rds/jakarta_district_centroid.rds\")\n```\n:::\n\n\n\n\n#### 2. Jakarta Villages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_village <- read_rds(\"data/rds/jakarta_village.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_village_centroid <- jakarta_village %>%\n  mutate(\n    centroid = st_centroid(geometry),\n    centroid_lat = st_coordinates(centroid)[, 2],\n    centroid_lng = st_coordinates(centroid)[, 1]\n )\n\njakarta_village_centroid$village <- str_to_title(jakarta_village_centroid$village)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(jakarta_village_centroid, \"data/rds/jakarta_village_centroid.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_village_centroid <- read_rds(\"data/rds/jakarta_village_centroid.rds\")\n```\n:::\n\n\n\n\n#### 3. Population Counts by District & Village\n\n1.  District\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_district_population <- read_rds(\"data/rds/jakarta_district_population.rds\")\n```\n:::\n\n\n\n\n2.  Village\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_village_population <- read_rds(\"data/rds/jakarta_village_population.rds\")\n```\n:::\n\n\n\n\n#### 4. Points of Interest Locations\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_poi <- read_rds(\"data/rds/jakarta_poi_final.rds\")\n```\n:::\n\n\n\n\n# Processing OD Data\n\n1.  Combining Trips Data with District Centroids\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert trips data to spatial objects for origin and destination points\norigin_sf <- trips %>%\n  st_as_sf(coords = c(\"origin_lng\", \"origin_lat\"), crs = 5580)\n\ndestination_sf <- trips %>%\n  st_as_sf(coords = c(\"destination_lng\", \"destination_lat\"), crs = 5580)\n\n# Transform the Jakarta district centroid data to match the CRS\njakarta_district_centroid <- jakarta_district_centroid %>%\n  st_transform(crs = 5580)\n\n# Perform spatial joins to associate centroids with origin and destination points\norigin_district_centroid <- st_join(origin_sf, jakarta_district_centroid, left = FALSE) %>%\n  select(\n    trj_id,\n    origin_district,\n    driving_mode,\n    origin_time_cluster,\n    origin_day, \n    cen_origin_lat = centroid_lat,   \n    cen_origin_lng = centroid_lng   \n  )\n\ndestination_district_centroid <- st_join(destination_sf, jakarta_district_centroid, left = FALSE) %>%\n  select(\n    trj_id,\n    destination_district,\n    cen_destination_lat = centroid_lat,  \n    cen_destination_lng = centroid_lng    \n  )\n\n# Remove geometries before joining to keep only relevant data\norigin_district_centroid_df <- origin_district_centroid %>% st_set_geometry(NULL)\ndestination_district_centroid_df <- destination_district_centroid %>% st_set_geometry(NULL)\n\n# Merge origin and destination data on `trj_id`\nod_district <- left_join(origin_district_centroid_df, destination_district_centroid_df, by = \"trj_id\")\n\n# Filter out intra-zonal flows (trips within the same district)\nod_district <- od_district %>%\n  filter(origin_district != destination_district) %>%\n  select(\n    trj_id,\n    origin_district,\n    destination_district,\n    driving_mode,\n    origin_time_cluster,\n    origin_day, \n    cen_origin_lat,\n    cen_origin_lng,\n    cen_destination_lat,\n    cen_destination_lng    \n  )\n\n# View the resulting dataset\nhead(od_district)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 10\n  trj_id origin_district destination_district driving_mode origin_time_cluster\n  <chr>  <chr>           <chr>                <chr>        <chr>              \n1 1      kebon jeruk     kebayoran baru       car          Afternoon Lull     \n2 10003  kelapa gading   pasar rebo           car          Morning Lull       \n3 10007  jagakarsa       pesanggrahan         car          Morning Peak       \n4 10014  pancoran        grogol petamburan    motorcycle   Morning Lull       \n5 10015  johar baru      cakung               car          Afternoon Lull     \n6 10016  jatinegara      kramatjati           car          Morning Lull       \n# ℹ 5 more variables: origin_day <chr>, cen_origin_lat <dbl>,\n#   cen_origin_lng <dbl>, cen_destination_lat <dbl>, cen_destination_lng <dbl>\n```\n\n\n:::\n:::\n\n\n\n\nNext we process the data by removing intra-zonal trips and removing duplicate or NA values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicate <- od_district %>% \n  group_by_all() %>% \n  filter(n() > 1) %>% \n  ungroup()\nduplicate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 10\n# ℹ 10 variables: trj_id <chr>, origin_district <chr>,\n#   destination_district <chr>, driving_mode <chr>, origin_time_cluster <chr>,\n#   origin_day <chr>, cen_origin_lat <dbl>, cen_origin_lng <dbl>,\n#   cen_destination_lat <dbl>, cen_destination_lng <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n2.  Combining Trips Data with Village Centroids\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert trips data to spatial objects for origin and destination points\norigin_sf <- trips %>%\n  st_as_sf(coords = c(\"origin_lng\", \"origin_lat\"), crs = 5580)\n\ndestination_sf <- trips %>%\n  st_as_sf(coords = c(\"destination_lng\", \"destination_lat\"), crs = 5580)\n\n# Transform the Jakarta village centroid data to match the CRS\njakarta_village_centroid <- jakarta_village_centroid %>%\n  st_transform(crs = 5580)\n\n# Perform spatial joins to associate centroids with origin and destination points at the village level\norigin_village_centroid <- st_join(origin_sf, jakarta_village_centroid, left = FALSE) %>%\n  select(\n    trj_id,\n    origin_village,\n    origin_district,\n    driving_mode,\n    origin_time_cluster,\n    origin_day, \n    cen_origin_lat = centroid_lat,   \n    cen_origin_lng = centroid_lng   \n  )\n\ndestination_village_centroid <- st_join(destination_sf, jakarta_village_centroid, left = FALSE) %>%\n  select(\n    trj_id,\n    destination_village,\n    destination_district,\n    cen_destination_lat = centroid_lat,  \n    cen_destination_lng = centroid_lng    \n  )\n\n# Remove geometries before joining to keep only relevant data\norigin_village_centroid_df <- origin_village_centroid %>% st_set_geometry(NULL)\ndestination_village_centroid_df <- destination_village_centroid %>% st_set_geometry(NULL)\n\n# Merge origin and destination data on `trj_id`\nod_village <- left_join(origin_village_centroid_df, destination_village_centroid_df, by = \"trj_id\")\n\n# Filter for intrazonal trips within the same district and retain relevant columns\nod_village <- od_village %>%\n  filter(origin_district == destination_district) %>%\n  filter(origin_village != destination_village) %>% \n  select(\n    trj_id,\n    origin_village,\n    destination_village,\n    origin_district,\n    driving_mode,\n    origin_time_cluster,\n    origin_day, \n    cen_origin_lat,\n    cen_origin_lng,\n    cen_destination_lat,\n    cen_destination_lng\n  )\n\n# View the resulting dataset\nhead(od_village)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 11\n  trj_id origin_village   destination_village origin_district driving_mode\n  <chr>  <chr>            <chr>               <chr>           <chr>       \n1 10108  rawajati         pancoran            pancoran        motorcycle  \n2 10132  kedoya selatan   sukabumi utara      kebon jeruk     car         \n3 10209  kebon jeruk      duri kepa           kebon jeruk     car         \n4 10293  ceger            cilangkap           cipayung        motorcycle  \n5 10296  pademangan timur ancol               pademangan      car         \n6 10304  kapuk            cengkareng timur    cengkareng      motorcycle  \n# ℹ 6 more variables: origin_time_cluster <chr>, origin_day <chr>,\n#   cen_origin_lat <dbl>, cen_origin_lng <dbl>, cen_destination_lat <dbl>,\n#   cen_destination_lng <dbl>\n```\n\n\n:::\n:::\n\n\n\n\nNext we process the data by removing intra-zonal trips and removing duplicate or NA values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicate <- od_village %>% \n  group_by_all() %>% \n  filter(n() > 1) %>% \n  ungroup()\nduplicate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 11\n# ℹ 11 variables: trj_id <chr>, origin_village <chr>,\n#   destination_village <chr>, origin_district <chr>, driving_mode <chr>,\n#   origin_time_cluster <chr>, origin_day <chr>, cen_origin_lat <dbl>,\n#   cen_origin_lng <dbl>, cen_destination_lat <dbl>, cen_destination_lng <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n# 5.0 Visualizing Spatial Interaction\n\n# 5.1 District Trips :\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_points_district <- od_district %>%\n  select(origin_district, cen_origin_lat, cen_origin_lng) %>%\n  distinct() %>%\n  st_as_sf(coords = c(\"cen_origin_lng\", \"cen_origin_lat\"), crs = 5580) %>%\n  rename(district = origin_district)\n\ndestination_points_district <- od_district %>%\n  select(destination_district, cen_destination_lat, cen_destination_lng) %>%\n  distinct() %>%\n  st_as_sf(coords = c(\"cen_destination_lng\", \"cen_destination_lat\"), crs = 5580) %>%\n  rename(district = destination_district)\n\norigin_points_village <- od_village %>%\n  select(origin_village, cen_origin_lat, cen_origin_lng) %>%\n  distinct() %>%\n  st_as_sf(coords = c(\"cen_origin_lng\", \"cen_origin_lat\"), crs = 5580) %>%\n  rename(village = origin_village)\n\ndestination_points_village <- od_village %>%\n  select(destination_village, cen_destination_lat, cen_destination_lng) %>%\n  distinct() %>%\n  st_as_sf(coords = c(\"cen_destination_lng\", \"cen_destination_lat\"), crs = 5580) %>%\n  rename(village = destination_village)\n```\n:::\n\n\n\n\n#5.2 Creating Desire Lines\n\nWe ensure the district is the first column before proceeding:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nod_district <- od_district %>% \n  select(origin_district, destination_district, origin_time_cluster, everything())\n\nod_village <- od_village %>% \n  select(origin_village, destination_village, origin_time_cluster, everything())\n```\n:::\n\n\n\n\n=========\n\n1.  District Level\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndesire_lines_district <- od2line(\n  flow = od_district, \n  zones = origin_points_district, \n  destination = destination_points_district\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nod_district_count <- od_district %>%\n  group_by(origin_district, destination_district) %>%\n  summarise(num_of_trips = n_distinct(trj_id), .groups = \"drop\") %>% \n  ungroup()\n\n# View the result\nhead(od_district_count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  origin_district destination_district num_of_trips\n  <chr>           <chr>                       <int>\n1 cakung          cempaka putih                   8\n2 cakung          cilincing                      22\n3 cakung          cipayung                        6\n4 cakung          duren sawit                    83\n5 cakung          gambir                          3\n6 cakung          jagakarsa                       2\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndesire_lines_district <- desire_lines_district %>%\n  left_join(od_district_count, by = c(\"origin_district\", \"destination_district\")) \n\ntmap_mode('plot')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(jakarta_district) + \n  tm_polygons(alpha = 0.3) + \n  tm_shape(jakarta_district_centroid) + \n  tm_dots(size = 0.1, \n          alpha = 0.5, \n          popup.vars = c(\"District\" = \"district\")) +\n  tm_shape(desire_lines_district) +\n  tm_lines(\n    col = \"num_of_trips\",          \n    palette = \"viridis\",         \n    lwd = 1,                    \n    alpha = 0.5,                \n    popup.vars = c(\"origin_district\", \"destination_district\", \"num_of_trips\")\n  ) +\n  tm_layout(legend.outside = TRUE)\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode('plot')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n:::\n\n\n\n\nWe save the output in rds format for future use:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(od_district, \"data/rds/od_district.rds\")\nwrite_rds(desire_lines_district, \"data/rds/desire_line_district.rds\")\n```\n:::\n\n\n\n\nWe import and save the rds into our R environment:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nod_district <- read_rds(\"data/rds/od_district.rds\")\ndesire_lines_district <-read_rds(\"data/rds/desire_line_district.rds\")\n```\n:::\n\n\n\n\n2.  Village Level Trips\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndesire_lines_village <- od2line(\n  flow = od_village, \n  zones = origin_points_village, \n  destination = destination_points_village\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nod_village_count <- od_village %>% \n  group_by(origin_village, destination_village) %>% \n  summarise(num_of_trips = n_distinct(trj_id), .groups = \"drop\") %>% \n  ungroup()\n\nhead(od_village_count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  origin_village destination_village    num_of_trips\n  <chr>          <chr>                         <int>\n1 ancol          pademangan barat                  1\n2 ancol          pademangan timur                  3\n3 balekambang    kramatjati                        1\n4 bali mester    bidara cina                       2\n5 bali mester    cipinang besar selatan            4\n6 bali mester    cipinang muara                    1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndesire_lines_village <- desire_lines_village %>%\n  left_join(od_village_count, by = c(\"origin_village\", \"destination_village\")) \n\ntmap_mode('plot')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(jakarta_village) + \n  tm_polygons(alpha = 0.3) + \n  tm_shape(jakarta_village_centroid) + \n  tm_dots(size = 0.1, \n          alpha = 0.5, \n          popup.vars = c(\"Village\" = \"village\")) +\n  tm_shape(desire_lines_village) +\n  tm_lines(\n    col = \"num_of_trips\",          \n    palette = \"viridis\",         \n    lwd = 1,                    \n    alpha = 0.5,                \n    popup.vars = c(\"origin_village\", \"destination_village\", \"num_of_trips\")\n  ) +\n  tm_layout(legend.outside = TRUE)\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode('plot')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n:::\n\n\n\n\nWe save the output in rds format for future use:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(od_village, \"data/rds/od_village.rds\")\nwrite_rds(desire_lines_village, \"data/rds/desire_line_village.rds\")\n```\n:::\n\n\n\n\nWe import and save the rds into our R environment:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nod_village <- read_rds(\"data/rds/od_village.rds\")\ndesire_lines_village <-read_rds(\"data/rds/desire_line_village.rds\")\n```\n:::\n\n\n\n\n# Spatial Interaction Modelling\n\n1.  Visualizing Distribution of POIs\n\nDistrict Level\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npoi_district_category <- jakarta_poi %>% \n  group_by(district, category) %>% \n  summarise(count = n(), .groups='drop') %>% \n  filter(!is.na(category)) %>% \n  st_drop_geometry()\n\ndatatable(poi_district_category)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-421cf3facb0304d5f5c1\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-421cf3facb0304d5f5c1\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\",\"86\",\"87\",\"88\",\"89\",\"90\",\"91\",\"92\",\"93\",\"94\",\"95\",\"96\",\"97\",\"98\",\"99\",\"100\",\"101\",\"102\",\"103\",\"104\",\"105\",\"106\",\"107\",\"108\",\"109\",\"110\",\"111\",\"112\",\"113\",\"114\",\"115\",\"116\",\"117\",\"118\",\"119\",\"120\",\"121\",\"122\",\"123\",\"124\",\"125\",\"126\",\"127\",\"128\",\"129\",\"130\",\"131\",\"132\",\"133\",\"134\",\"135\",\"136\",\"137\",\"138\",\"139\",\"140\",\"141\",\"142\",\"143\",\"144\",\"145\",\"146\",\"147\",\"148\",\"149\",\"150\",\"151\",\"152\",\"153\",\"154\",\"155\",\"156\",\"157\",\"158\",\"159\",\"160\",\"161\",\"162\",\"163\",\"164\",\"165\",\"166\",\"167\",\"168\",\"169\",\"170\",\"171\",\"172\",\"173\",\"174\",\"175\",\"176\",\"177\",\"178\",\"179\",\"180\",\"181\",\"182\",\"183\",\"184\",\"185\",\"186\",\"187\",\"188\",\"189\",\"190\",\"191\",\"192\",\"193\",\"194\",\"195\",\"196\",\"197\",\"198\",\"199\",\"200\",\"201\",\"202\",\"203\",\"204\",\"205\",\"206\",\"207\",\"208\",\"209\",\"210\",\"211\",\"212\",\"213\",\"214\",\"215\",\"216\",\"217\",\"218\",\"219\",\"220\",\"221\",\"222\",\"223\",\"224\",\"225\",\"226\",\"227\",\"228\",\"229\",\"230\",\"231\",\"232\",\"233\",\"234\",\"235\",\"236\",\"237\",\"238\",\"239\",\"240\",\"241\",\"242\",\"243\",\"244\",\"245\",\"246\",\"247\",\"248\",\"249\",\"250\",\"251\",\"252\",\"253\",\"254\",\"255\",\"256\",\"257\",\"258\",\"259\",\"260\",\"261\",\"262\",\"263\",\"264\",\"265\",\"266\",\"267\",\"268\",\"269\",\"270\",\"271\",\"272\",\"273\",\"274\",\"275\",\"276\",\"277\",\"278\",\"279\",\"280\",\"281\",\"282\",\"283\",\"284\",\"285\",\"286\",\"287\",\"288\",\"289\",\"290\",\"291\",\"292\",\"293\",\"294\",\"295\",\"296\",\"297\",\"298\",\"299\",\"300\",\"301\",\"302\",\"303\",\"304\",\"305\",\"306\",\"307\",\"308\",\"309\",\"310\",\"311\",\"312\",\"313\",\"314\",\"315\",\"316\",\"317\",\"318\",\"319\",\"320\",\"321\",\"322\",\"323\",\"324\",\"325\",\"326\",\"327\",\"328\",\"329\",\"330\",\"331\",\"332\",\"333\",\"334\",\"335\",\"336\",\"337\",\"338\",\"339\",\"340\",\"341\",\"342\",\"343\",\"344\",\"345\",\"346\",\"347\",\"348\",\"349\",\"350\",\"351\",\"352\",\"353\",\"354\",\"355\",\"356\",\"357\",\"358\",\"359\",\"360\"],[\"cakung\",\"cakung\",\"cakung\",\"cakung\",\"cakung\",\"cakung\",\"cakung\",\"cakung\",\"cempaka putih\",\"cempaka putih\",\"cempaka putih\",\"cempaka putih\",\"cempaka putih\",\"cempaka putih\",\"cempaka putih\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cengkareng\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilandak\",\"cilincing\",\"cilincing\",\"cilincing\",\"cilincing\",\"cilincing\",\"cilincing\",\"cilincing\",\"cilincing\",\"cipayung\",\"cipayung\",\"cipayung\",\"cipayung\",\"cipayung\",\"cipayung\",\"cipayung\",\"cipayung\",\"cipayung\",\"ciracas\",\"ciracas\",\"ciracas\",\"ciracas\",\"ciracas\",\"ciracas\",\"ciracas\",\"ciracas\",\"danau sunter\",\"danau sunter dll\",\"danau sunter dll\",\"danau sunter dll\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"duren sawit\",\"gambir\",\"gambir\",\"gambir\",\"gambir\",\"gambir\",\"gambir\",\"gambir\",\"gambir\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"grogol petamburan\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jagakarsa\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"jatinegara\",\"johar baru\",\"johar baru\",\"johar baru\",\"johar baru\",\"johar baru\",\"johar baru\",\"kalideres\",\"kalideres\",\"kalideres\",\"kalideres\",\"kalideres\",\"kalideres\",\"kalideres\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran baru\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebayoran lama\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kebon jeruk\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kelapa gading\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kemayoran\",\"kembangan\",\"kembangan\",\"kembangan\",\"kembangan\",\"kembangan\",\"kembangan\",\"kembangan\",\"kembangan\",\"kembangan\",\"koja\",\"koja\",\"koja\",\"koja\",\"koja\",\"koja\",\"koja\",\"koja\",\"koja\",\"kramatjati\",\"kramatjati\",\"kramatjati\",\"kramatjati\",\"kramatjati\",\"kramatjati\",\"kramatjati\",\"kramatjati\",\"makasar\",\"makasar\",\"makasar\",\"makasar\",\"makasar\",\"makasar\",\"makasar\",\"makasar\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"mampang prapatan\",\"matraman\",\"matraman\",\"matraman\",\"matraman\",\"matraman\",\"matraman\",\"matraman\",\"matraman\",\"menteng\",\"menteng\",\"menteng\",\"menteng\",\"menteng\",\"menteng\",\"menteng\",\"menteng\",\"menteng\",\"pademangan\",\"pademangan\",\"pademangan\",\"pademangan\",\"pademangan\",\"pademangan\",\"pademangan\",\"pademangan\",\"pademangan\",\"pal merah\",\"pal merah\",\"pal merah\",\"pal merah\",\"pal merah\",\"pal merah\",\"pal merah\",\"pal merah\",\"pal merah\",\"pancoran\",\"pancoran\",\"pancoran\",\"pancoran\",\"pancoran\",\"pancoran\",\"pancoran\",\"pancoran\",\"pancoran\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar minggu\",\"pasar rebo\",\"pasar rebo\",\"pasar rebo\",\"pasar rebo\",\"pasar rebo\",\"pasar rebo\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"penjaringan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pesanggrahan\",\"pulogadung\",\"pulogadung\",\"pulogadung\",\"pulogadung\",\"pulogadung\",\"pulogadung\",\"pulogadung\",\"pulogadung\",\"sawah besar\",\"sawah besar\",\"sawah besar\",\"sawah besar\",\"sawah besar\",\"sawah besar\",\"sawah besar\",\"sawah besar\",\"senen\",\"senen\",\"senen\",\"senen\",\"senen\",\"senen\",\"senen\",\"senen\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"setiabudi\",\"taman sari\",\"taman sari\",\"taman sari\",\"taman sari\",\"taman sari\",\"taman sari\",\"taman sari\",\"taman sari\",\"taman sari\",\"tambora\",\"tambora\",\"tambora\",\"tambora\",\"tambora\",\"tambora\",\"tambora\",\"tambora\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanah abang\",\"tanjung priok\",\"tanjung priok\",\"tanjung priok\",\"tanjung priok\",\"tanjung priok\",\"tanjung priok\",\"tanjung priok\",\"tanjung priok\",\"tebet\",\"tebet\",\"tebet\",\"tebet\",\"tebet\",\"tebet\",\"tebet\",\"tebet\",\"tebet\"],[\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Essentials\",\"Facilities_Services\",\"Others\",\"Shops\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Essentials\",\"Facilities_Services\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\",\"Cultural_Attractions\",\"Essentials\",\"Facilities_Services\",\"Offices_Business\",\"Others\",\"Recreation_Entertainment\",\"Restaurants_Food\",\"Shops\",\"Tourism_Spots\"],[1,12,16,18,2,3,3,1,1,8,9,1,9,4,6,8,49,64,65,3,1,48,51,9,15,25,23,30,2,4,54,77,12,6,29,56,3,3,4,17,1,3,4,16,2,3,2,15,10,1,3,26,20,4,38,1,14,20,1,1,1,1,1,15,37,55,1,1,25,36,2,4,55,59,167,9,59,114,29,3,58,95,102,15,5,145,124,21,12,32,27,9,40,5,75,56,3,2,31,47,6,6,1,19,25,2,1,1,1,2,7,1,10,19,32,42,5,12,15,20,27,60,146,6,13,185,105,32,9,23,27,5,2,6,70,48,12,7,40,27,42,11,3,121,56,6,4,17,10,65,2,2,31,15,10,1,41,50,22,9,1,8,34,8,10,20,17,107,9,5,22,38,11,1,31,25,9,1,1,8,17,6,8,11,19,6,3,16,26,3,1,6,23,1,4,15,8,2,4,7,9,20,6,5,25,21,10,3,23,30,5,8,16,9,5,6,22,64,77,16,17,129,60,67,2,38,26,52,33,2,11,19,10,3,13,40,37,7,2,149,54,5,6,17,23,24,3,1,24,36,3,9,35,43,53,8,1,37,58,14,18,28,6,9,11,21,10,97,64,125,5,4,102,58,12,10,23,25,2,9,2,32,21,3,3,55,54,25,2,18,15,2,4,15,25,58,4,23,29,32,5,34,42,55,4,26,49,21,8,33,67,77,18,17,242,87,36,10,34,35,93,3,14,73,54,31,2,52,21,37,19,19,38,5,14,36,64,99,11,9,112,76,36,4,63,55,87,17,24,38,7,4,18,39,43,14,3,104,59,11]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>district<\\/th>\\n      <th>category<\\/th>\\n      <th>count<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":3},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"district\",\"targets\":1},{\"name\":\"category\",\"targets\":2},{\"name\":\"count\",\"targets\":3}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n\n```{.r .cell-code}\npoi_district_category_wide <- poi_district_category %>% \n  pivot_wider(\n    names_from = category, \n    values_from = count, \n    values_fill = 0\n  )\n\njakarta_district_counts <- jakarta_district %>% \n  left_join(poi_district_category_wide, by = \"district\")\n\ncategory_maps <- names(poi_district_category_wide)[-1]\nmap_list <- lapply(category_maps, function(category) {\n  tm_shape(jakarta_district_counts) +\n    tm_polygons(\n      col = category, \n      palette = \"Blues\", \n      title = paste(category),\n      style = \"quantile\"\n    ) +\n    tm_layout(main.title = paste(category), main.title.size = 1.2)\n})\n\npoi_district_category <- poi_district_category %>%\n  mutate(district = tolower(district))\n\njakarta_district_centroid <- jakarta_district_centroid %>%\n  mutate(district = tolower(district))\n\ntooltip_category_data <- poi_district_category %>%\n  pivot_wider(\n    names_from = category,\n    values_from = count,\n    values_fill = list(count = 0)  # Fill missing values with 0\n  )\n\n\nrequired_categories <- c(\n  \"Facilities_Services\", \"Restaurants_Food\", \"Essentials\", \n  \"Offices_Business\", \"Cultural_Attractions\", \"Recreation_Entertainment\",\n  \"Shops\", \"Tourism_Spots\", \"Others\"\n)\n\nfor (category in required_categories) {\n  if (!category %in% colnames(tooltip_category_data)) {\n    tooltip_category_data[[category]] <- 0\n  }\n}\n\njakarta_district_centroid_expanded <- jakarta_district_centroid %>%\n  left_join(tooltip_category_data, by = \"district\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(jakarta_district) +  \n  tm_polygons(alpha = 0.3, border.col = \"black\") +  # District boundaries\n  tm_shape(jakarta_district_centroid_expanded) + \n  tm_dots(\n    size = 0.1, col = \"blue\", alpha = 0.5,\n    popup.vars = c(\n      \"District\" = \"district\",\n      \"Facilities_Services\" = \"Facilities_Services\",\n      \"Restaurants_Food\" = \"Restaurants_Food\",\n      \"Essentials\" = \"Essentials\",\n      \"Offices_Business\" = \"Offices_Business\",\n      \"Cultural_Attractions\" = \"Cultural_Attractions\",\n      \"Recreation_Entertainment\" = \"Recreation_Entertainment\", \n      \"Shops\" = \"Shops\", \n      \"Tourism_Spots\" = \"Tourism_Spots\",\n      \"Others\" = \"Others\"\n    )\n  ) +\n  tm_basemap(\"OpenStreetMap\")\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n\n\nVillage Level\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Aggregate POI data by village and category\npoi_village_category <- jakarta_poi %>% \n  group_by(village, category) %>% \n  summarise(count = n(), .groups = 'drop') %>% \n  filter(!is.na(category)) %>% \n  st_drop_geometry()  \n\n# Step 2: Pivot the data so that each category becomes a column\ntooltip_village_category_data <- poi_village_category %>% \n  pivot_wider(\n    names_from = category,           # Convert categories to columns\n    values_from = count,             # Fill columns with the count of each category\n    values_fill = list(count = 0)    # Fill missing values with 0\n  )\n\n# Step 3: Ensure all required categories are present\nrequired_categories <- c(\n  \"Facilities_Services\", \"Restaurants_Food\", \"Essentials\", \n  \"Offices_Business\", \"Cultural_Attractions\", \"Recreation_Entertainment\",\n  \"Shops\", \"Tourism_Spots\", \"Others\"\n)\n\n# Add missing categories with default value 0\nfor (category in required_categories) {\n  if (!category %in% colnames(tooltip_village_category_data)) {\n    tooltip_village_category_data[[category]] <- 0\n  }\n}\n\n# Step 4: Standardize the village names to lowercase for matching\ntooltip_village_category_data <- tooltip_village_category_data %>%\n  mutate(village = tolower(village))\n\njakarta_village_centroid <- jakarta_village_centroid %>%\n  mutate(village = tolower(village))  # Assuming centroids also include a village column\n\n# Step 5: Join the tooltip data with village centroids\njakarta_village_centroid_expanded <- jakarta_village_centroid %>%\n  left_join(tooltip_village_category_data, by = \"village\")  # Join by village\n\n# Step 6: Confirm the structure of the final dataset\nglimpse(jakarta_village_centroid_expanded)  # Ensure no duplicates and correct structure\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 263\nColumns: 16\n$ district                 <chr> \"cakung\", \"cakung\", \"cakung\", \"cakung\", \"caku…\n$ province                 <chr> \"jakarta\", \"jakarta\", \"jakarta\", \"jakarta\", \"…\n$ village                  <chr> \"cakung barat\", \"cakung timur\", \"jatinegara\",…\n$ geometry                 <POLYGON [m]> POLYGON ((13577052 -2958919..., POLYG…\n$ centroid                 <POINT [m]> POINT (13571669 -2963739), POINT (13580…\n$ centroid_lat             <dbl> -2963739, -2967147, -2972129, -2976894, -2980…\n$ centroid_lng             <dbl> 13571669, 13580489, 13557720, 13564941, 13572…\n$ Cultural_Attractions     <int> 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 6, 0, 1, 0, …\n$ Essentials               <int> 0, 4, 3, 0, 4, 0, 1, 0, 6, 2, 9, 21, 6, 5, 4,…\n$ Facilities_Services      <int> 3, 1, 1, 4, 2, 3, 2, 2, 5, 2, 8, 23, 7, 12, 4…\n$ Offices_Business         <int> 2, 1, 1, 2, 1, 10, 1, 0, 0, 0, 24, 26, 9, 2, …\n$ Others                   <int> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 2, 1, …\n$ Recreation_Entertainment <int> 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, …\n$ Restaurants_Food         <int> 1, 0, 0, 1, 0, 1, 0, 2, 3, 4, 3, 32, 5, 6, 0,…\n$ Shops                    <int> 0, 0, 0, 2, 0, 0, 1, 1, 2, 1, 0, 38, 6, 6, 1,…\n$ Tourism_Spots            <int> 0, 0, 1, 0, 0, 0, 0, 1, 1, 4, 1, 4, 3, 0, 1, …\n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 7: Visualize using tmap for each category\ncategory_maps <- names(tooltip_village_category_data)[-1]  # Exclude the 'village' column\nmap_list <- lapply(category_maps, function(category) {\n  tm_shape(jakarta_village_centroid_expanded) +\n    tm_polygons(\n      col = category, \n      palette = \"Blues\", \n      title = paste(category),\n      style = \"quantile\"\n    ) +\n    tm_layout(main.title = paste(category), main.title.size = 1.2)\n})\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(jakarta_village_centroid_expanded) +  \n  tm_dots(\n    size = 0.3, col = \"blue\", alpha = 0.7,  # Adjust size and alpha for better visibility\n    popup.vars = c(\n      \"Village\" = \"village\",\n      \"Cultural Attractions\" = \"Cultural_Attractions\",\n      \"Essentials\" = \"Essentials\",\n      \"Facilities Services\" = \"Facilities_Services\",\n      \"Offices Business\" = \"Offices_Business\",\n      \"Recreation Entertainment\" = \"Recreation_Entertainment\", \n      \"Restaurants Food\" = \"Restaurants_Food\",\n      \"Shops\" = \"Shops\", \n      \"Tourism Spots\" = \"Tourism_Spots\",\n      \"Others\" = \"Others\"\n    )\n  ) +\n  tm_basemap(\"OpenStreetMap\")\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\n\n\nWe save the files in RDS\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(jakarta_district_centroid_expanded,\"data/rds/jakarta_district_centroid_expanded.rds\")\nwrite_rds(jakarta_village_centroid_expanded, \"data/rds/jakarta_village_centroid_expanded.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_district_centroid_expanded <- readRDS(\"data/rds/jakarta_district_centroid_expanded.rds\")\njakarta_village_centroid_expanded <- readRDS(\"data/rds/jakarta_village_centroid_expanded.rds\")\n```\n:::\n\n\n\n\n\n# Spatial Interaction Modelling\n\nWe will be exploring\n\n1.  Origin Constrained Model\n2.  Destination Constrained Model\n3.  Doubly Constrained Model\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(poi_district_category)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  district category                 count\n  <chr>    <chr>                    <int>\n1 cakung   Cultural_Attractions         1\n2 cakung   Essentials                  12\n3 cakung   Facilities_Services         16\n4 cakung   Offices_Business            18\n5 cakung   Recreation_Entertainment     2\n6 cakung   Restaurants_Food             3\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(poi_village_category)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  village category                 count\n  <chr>   <chr>                    <int>\n1 ancol   Cultural_Attractions         2\n2 ancol   Essentials                  10\n3 ancol   Facilities_Services          7\n4 ancol   Offices_Business            39\n5 ancol   Others                      22\n6 ancol   Recreation_Entertainment     1\n```\n\n\n:::\n:::\n\n\n\n\nDISTIRCTS\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_dist_centroid_category_sp <- as(jakarta_district_centroid_expanded$centroid, 'Spatial')\njakarta_dist_centroid_category_sp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatialPoints \nfeatures    : 44 \nextent      : 13484482, 13585145, -3018643, -2900422  (xmin, xmax, ymin, ymax)\ncrs         : +proj=tmerc +lat_0=0 +lon_0=30 +k=1 +x_0=300000 +y_0=0 +ellps=krass +units=m +no_defs \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndist_districts <- spDists(jakarta_dist_centroid_category_sp, longlat=FALSE)\nrownames(dist_districts) <- jakarta_district_centroid_expanded$district\ncolnames(dist_districts) <- jakarta_district_centroid_expanded$district\nhead(dist_districts, n=c(5,5))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                cakung cempaka putih cengkareng  cilandak cilincing\ncakung            0.00      33263.08   94324.66  81967.78  28425.45\ncempaka putih 33263.08          0.00   61173.55  61066.05  42594.46\ncengkareng    94324.66      61173.55       0.00  68553.90  95227.61\ncilandak      81967.78      61066.05   68553.90      0.00 102044.78\ncilincing     28425.45      42594.46   95227.61 102044.78      0.00\n```\n\n\n:::\n:::\n\n\n\n\nVILLAGES\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njakarta_vill_centroid_category_sp <- as(jakarta_village_centroid_expanded$centroid, 'Spatial')\njakarta_vill_centroid_category_sp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatialPoints \nfeatures    : 263 \nextent      : 13479209, 13595039, -3031291, -2886145  (xmin, xmax, ymin, ymax)\ncrs         : +proj=tmerc +lat_0=0 +lon_0=30 +k=1 +x_0=300000 +y_0=0 +ellps=krass +units=m +no_defs \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndist_villages <- spDists(jakarta_vill_centroid_category_sp, longlat=FALSE)\nrownames(dist_villages) <- jakarta_village_centroid_expanded$village\ncolnames(dist_villages) <- jakarta_village_centroid_expanded$village\nhead(dist_villages, n=c(5,5))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             cakung barat cakung timur jatinegara penggilingan pulo gebang\ncakung barat        0.000     9455.626  16278.153    14775.743   16679.772\ncakung timur     9455.626        0.000  23308.139    18350.774   15530.917\njatinegara      16278.153    23308.139      0.000     8651.674   16848.276\npenggilingan    14775.743    18350.774   8651.674        0.000    8239.968\npulo gebang     16679.772    15530.917  16848.276     8239.968       0.000\n```\n\n\n:::\n:::\n\n\n\n\n# Computing Distance Matrix\n\n### Pivot Distance Value by Origin and Destination District\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistPair_district <- melt(dist_districts) %>%\n  rename(dist = value)\nhead(distPair_district, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Var1   Var2     dist\n1            cakung cakung     0.00\n2     cempaka putih cakung 33263.08\n3        cengkareng cakung 94324.66\n4          cilandak cakung 81967.78\n5         cilincing cakung 28425.45\n6          cipayung cakung 64521.80\n7           ciracas cakung 71847.97\n8      danau sunter cakung 41185.22\n9  danau sunter dll cakung 46710.26\n10      duren sawit cakung 21989.05\n```\n\n\n:::\n:::\n\n\n\n\nThere are intrazonal distances with 0 values (interzones)\n\nBefore proceeding, we update them with the lowest non-zero distance values before applying log transformation given that log 0 is an undefined value. The lowest minimum distance is 4074 m, any distance less than this can represent the intrazonal distance. For consistency and ease of remberance, we stick to 2000m as the intra-zonal distance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistPair_district %>% \n  filter(dist > 0) %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Var1                 Var2           dist       \n cakung       :  43   cakung       :  43   Min.   :  4074  \n cempaka putih:  43   cempaka putih:  43   1st Qu.: 28433  \n cengkareng   :  43   cengkareng   :  43   Median : 44542  \n cilandak     :  43   cilandak     :  43   Mean   : 46927  \n cilincing    :  43   cilincing    :  43   3rd Qu.: 62932  \n cipayung     :  43   cipayung     :  43   Max.   :125054  \n (Other)      :1634   (Other)      :1634                   \n```\n\n\n:::\n\n```{.r .cell-code}\ndistPair_district$dist <- ifelse (distPair_district$dist == 0, \n                         2000, distPair_district$dist) \ndistPair_district <- distPair_district %>% \n  rename(origin=Var1, \n         destination =Var2) %>% \n  mutate(across(c(origin, destination), as.factor))\n\nsummary(distPair_district)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           origin            destination        dist       \n cakung       :  44   cakung       :  44   Min.   :  2000  \n cempaka putih:  44   cempaka putih:  44   1st Qu.: 27275  \n cengkareng   :  44   cengkareng   :  44   Median : 43636  \n cilandak     :  44   cilandak     :  44   Mean   : 45906  \n cilincing    :  44   cilincing    :  44   3rd Qu.: 62427  \n cipayung     :  44   cipayung     :  44   Max.   :125054  \n (Other)      :1672   (Other)      :1672                   \n```\n\n\n:::\n:::\n\n\n\n\nVillage\n\nBefore proceeding, we update them with the lowest non-zero distance values before applying log transformation given that log 0 is an undefined value. The lowest minimum distance is 1537 m, any distance less than this can represent the intrazonal distance. For consistency and ease of remberance, we stick to 1000m as the intra-zonal distance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistPair_village <- melt(dist_villages) %>%\n  rename(dist = value)\nhead(distPair_village, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  Var1         Var2      dist\n1         cakung barat cakung barat     0.000\n2         cakung timur cakung barat  9455.626\n3           jatinegara cakung barat 16278.153\n4         penggilingan cakung barat 14775.743\n5          pulo gebang cakung barat 16679.772\n6          rawa terate cakung barat  8304.716\n7        ujung menteng cakung barat 13932.310\n8  cempaka putih barat cakung barat 32542.221\n9  cempaka putih timur cakung barat 28821.832\n10            rawasari cakung barat 32369.583\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndistPair_village %>% \n  filter(dist > 0) %>% \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           Var1                 Var2            dist       \n cakung barat:  262   cakung barat:  262   Min.   :  1537  \n cakung timur:  262   cakung timur:  262   1st Qu.: 27686  \n jatinegara  :  262   jatinegara  :  262   Median : 43513  \n penggilingan:  262   penggilingan:  262   Mean   : 46122  \n pulo gebang :  262   pulo gebang :  262   3rd Qu.: 61731  \n rawa terate :  262   rawa terate :  262   Max.   :148524  \n (Other)     :67334   (Other)     :67334                   \n```\n\n\n:::\n\n```{.r .cell-code}\ndistPair_village$dist <- ifelse (distPair_village$dist == 0, \n                         1000, distPair_village$dist) \ndistPair_village <- distPair_village %>% \n  rename(origin=Var1, \n         destination =Var2) %>% \n  mutate(across(c(origin, destination), as.factor))\n\nsummary(distPair_village)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          origin            destination         dist       \n cakung barat:  263   cakung barat:  263   Min.   :  1000  \n cakung timur:  263   cakung timur:  263   1st Qu.: 27473  \n jatinegara  :  263   jatinegara  :  263   Median : 43390  \n penggilingan:  263   penggilingan:  263   Mean   : 45951  \n pulo gebang :  263   pulo gebang :  263   3rd Qu.: 61654  \n rawa terate :  263   rawa terate :  263   Max.   :148524  \n (Other)     :67591   (Other)     :67591                   \n```\n\n\n:::\n:::\n\n\n\n\n## Applying Log Transformation to Variables of Interest\n\nWe apply log transformation for the variables of interest (categories of POI for push and pull factors), to use Poisson Regresion method.\n\nDISTRICT\n\n1.  For the subset of POIs in Origin and Destination Districts, we rename accordingly\n2.  We merge the distPair with POI data for both origin and destination subsets\n3.  We Pivot the POI data wide to separate the categories into individual columns & counts\n4.  We apply Log Transformation to the category columns\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Step 1\npoi_district_category_origin <- poi_district_category %>% \n  rename(origin = district)\n\npoi_district_category_destination <- poi_district_category %>% \n  rename(destination = district)\n\n#Step 2\ndist_POI_district <- distPair_district %>%\n  left_join(poi_district_category_origin, by = \"origin\") %>%\n  left_join(poi_district_category_destination , by = \"destination\", suffix = c(\"_origin\", \"_destination\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in left_join(., poi_district_category_origin, by = \"origin\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 1 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in left_join(., poi_district_category_destination, by = \"destination\", : Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 1 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n\n```{.r .cell-code}\n#Step 3\npoi_origin_wide_district <- dist_POI_district %>%\n  pivot_wider(\n    names_from = category_origin,\n    values_from = count_origin,\n    names_prefix = \"origin_\",\n    values_fill = list(count_origin = 0)\n  )\n\npoi_orig_dest_wide_district <- poi_origin_wide_district %>%\n  pivot_wider(\n    names_from = category_destination,\n    values_from = count_destination,\n    names_prefix = \"destination_\",\n    values_fill = list(count_destination = 0)\n  )\n\n\n#Step 4\ncolumns_to_log_transform <- colnames(poi_orig_dest_wide_district)[4:19]\n\n\npoi_orig_dest_wide_district[columns_to_log_transform] <- lapply(\n  poi_orig_dest_wide_district[columns_to_log_transform],\n  function(x) log(as.numeric(as.character(x)) + 1)\n)\n\nhead(poi_orig_dest_wide_district[columns_to_log_transform])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 16\n  origin_Cultural_Attractions origin_Essentials origin_Facilities_Services\n                        <dbl>             <dbl>                      <dbl>\n1                       0.693              2.56                       2.83\n2                       0.693              2.20                       2.30\n3                       2.20               3.91                       4.17\n4                       2.77               3.26                       3.18\n5                       1.95               3.40                       4.04\n6                       1.39               1.61                       2.83\n# ℹ 13 more variables: origin_Offices_Business <dbl>,\n#   origin_Recreation_Entertainment <dbl>, origin_Restaurants_Food <dbl>,\n#   origin_Shops <dbl>, origin_Tourism_Spots <dbl>, origin_Others <dbl>,\n#   destination_Cultural_Attractions <dbl>, destination_Essentials <dbl>,\n#   destination_Facilities_Services <dbl>, destination_Offices_Business <dbl>,\n#   destination_Recreation_Entertainment <dbl>,\n#   destination_Restaurants_Food <dbl>, destination_Shops <dbl>\n```\n\n\n:::\n:::\n\n\n\n\nVILLAGE\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Rename for origin and destination at the village level\npoi_village_category_origin <- poi_village_category %>% \n  rename(origin = village)\n\npoi_village_category_destination <- poi_village_category %>% \n  rename(destination = village)\n\n# Step 2: Join POI data for origin and destination\ndist_POI_village <- distPair_village %>%\n  left_join(poi_village_category_origin, by = \"origin\") %>%\n  left_join(poi_village_category_destination, by = \"destination\", suffix = c(\"_origin\", \"_destination\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in left_join(., poi_village_category_origin, by = \"origin\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 72 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in left_join(., poi_village_category_destination, by = \"destination\", : Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 72 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Step 3: Pivot origin data into wide format\npoi_origin_wide_village <- dist_POI_village %>%\n  pivot_wider(\n    names_from = category_origin,\n    values_from = count_origin,\n    names_prefix = \"origin_\",\n    values_fill = list(count_origin = 0)\n  )\n\n# Pivot destination data into wide format\npoi_orig_dest_wide_village <- poi_origin_wide_village %>%\n  pivot_wider(\n    names_from = category_destination,\n    values_from = count_destination,\n    names_prefix = \"destination_\",\n    values_fill = list(count_destination = 0)\n  )\n\n# Step 4: Apply log transformation to specified columns\ncolumns_to_log_transform <- colnames(poi_orig_dest_wide_village)[4:19]  # Adjust based on your dataset structure\n\npoi_orig_dest_wide_village[columns_to_log_transform] <- lapply(\n  poi_orig_dest_wide_village[columns_to_log_transform],\n  function(x) log(as.numeric(as.character(x)) + 1)  # Apply log transformation\n)\n\n# Step 5: Verify the output\nhead(poi_orig_dest_wide_village[columns_to_log_transform])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 16\n  origin_Facilities_Services origin_Offices_Business origin_Restaurants_Food\n                       <dbl>                   <dbl>                   <dbl>\n1                      1.39                    1.10                    0.693\n2                      0.693                   0.693                   0    \n3                      0.693                   0.693                   0    \n4                      1.61                    1.10                    0.693\n5                      1.10                    0.693                   0    \n6                      1.39                    2.40                    0.693\n# ℹ 13 more variables: origin_Essentials <dbl>,\n#   origin_Recreation_Entertainment <dbl>, origin_Tourism_Spots <dbl>,\n#   origin_Shops <dbl>, origin_Cultural_Attractions <dbl>, origin_Others <dbl>,\n#   origin_NA <dbl>, destination_Facilities_Services <dbl>,\n#   destination_Offices_Business <dbl>, destination_Restaurants_Food <dbl>,\n#   destination_Essentials <dbl>, destination_Recreation_Entertainment <dbl>,\n#   destination_Tourism_Spots <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n# Origin Constrained Spatial Interaction Model\n\nThe origin-constrained model focuses on constraints at the origin locations, meaning the sum of interactions originating from each origin equals a known total, such as the total number of trips from each origin district. Here, only **pull (attractive) factors** of the **destination** districts will be used.\n\nDISTRICT\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nod_district <- od_district %>%\n  rename(\n    origin = origin_district,\n    destination = destination_district\n  )\n\ntripsDistrict <- left_join(od_district, poi_orig_dest_wide_district, by = c(\"origin\", \"destination\")) %>%\n  group_by(origin, destination) %>%\n  mutate(trips_count = n_distinct(trj_id)) %>%\n  ungroup()  \n\ntripsDistrict <- tripsDistrict %>% \n  rename(\n    origin_ = origin,\n    destination_ = destination\n  )\n\norigSIM_district <- glm(\n  trips_count ~ origin_ + destination_Cultural_Attractions + destination_Essentials + \n                destination_Facilities_Services + destination_Offices_Business + \n                destination_Others + destination_Restaurants_Food + \n                destination_Shops + destination_Recreation_Entertainment + \n                dist - 1,  \n  family = poisson(link = \"log\"),\n  data = tripsDistrict,\n  na.action = na.exclude\n)\n\n\nsummary(origSIM_district)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = trips_count ~ origin_ + destination_Cultural_Attractions + \n    destination_Essentials + destination_Facilities_Services + \n    destination_Offices_Business + destination_Others + destination_Restaurants_Food + \n    destination_Shops + destination_Recreation_Entertainment + \n    dist - 1, family = poisson(link = \"log\"), data = tripsDistrict, \n    na.action = na.exclude)\n\nCoefficients:\n                                       Estimate Std. Error  z value Pr(>|z|)\norigin_cakung                         3.992e+00  1.085e-02  367.853  < 2e-16\norigin_cempaka putih                  2.847e+00  1.175e-02  242.321  < 2e-16\norigin_cengkareng                     4.055e+00  8.514e-03  476.252  < 2e-16\norigin_cilandak                       3.841e+00  9.196e-03  417.723  < 2e-16\norigin_cilincing                      3.875e+00  1.391e-02  278.577  < 2e-16\norigin_cipayung                       3.958e+00  1.200e-02  329.834  < 2e-16\norigin_ciracas                        3.852e+00  1.054e-02  365.645  < 2e-16\norigin_danau sunter                   5.487e-01  4.473e-01    1.227     0.22\norigin_danau sunter dll               9.126e-01  1.023e-01    8.923  < 2e-16\norigin_duren sawit                    4.267e+00  8.647e-03  493.408  < 2e-16\norigin_gambir                         3.487e+00  8.326e-03  418.819  < 2e-16\norigin_grogol petamburan              4.256e+00  7.609e-03  559.286  < 2e-16\norigin_jagakarsa                      4.150e+00  9.434e-03  439.910  < 2e-16\norigin_jatinegara                     3.667e+00  8.601e-03  426.358  < 2e-16\norigin_johar baru                     1.881e+00  2.630e-02   71.507  < 2e-16\norigin_kalideres                      4.028e+00  1.004e-02  401.152  < 2e-16\norigin_kebayoran baru                 4.188e+00  7.484e-03  559.595  < 2e-16\norigin_kebayoran lama                 3.791e+00  8.218e-03  461.348  < 2e-16\norigin_kebon jeruk                    3.864e+00  8.126e-03  475.546  < 2e-16\norigin_kelapa gading                  4.220e+00  7.818e-03  539.723  < 2e-16\norigin_kemayoran                      3.237e+00  9.688e-03  334.117  < 2e-16\norigin_kembangan                      3.923e+00  8.861e-03  442.726  < 2e-16\norigin_koja                           3.328e+00  1.324e-02  251.451  < 2e-16\norigin_kramatjati                     3.768e+00  8.930e-03  421.999  < 2e-16\norigin_makasar                        3.393e+00  1.288e-02  263.325  < 2e-16\norigin_mampang prapatan               3.165e+00  9.860e-03  320.955  < 2e-16\norigin_matraman                       2.709e+00  1.304e-02  207.725  < 2e-16\norigin_menteng                        3.318e+00  8.671e-03  382.694  < 2e-16\norigin_pademangan                     3.316e+00  1.082e-02  306.389  < 2e-16\norigin_pal merah                      3.258e+00  9.122e-03  357.142  < 2e-16\norigin_pancoran                       3.399e+00  9.166e-03  370.775  < 2e-16\norigin_pasar minggu                   4.143e+00  7.998e-03  518.067  < 2e-16\norigin_pasar rebo                     3.039e+00  1.605e-02  189.354  < 2e-16\norigin_penjaringan                    4.324e+00  8.493e-03  509.133  < 2e-16\norigin_pesanggrahan                   3.188e+00  1.200e-02  265.531  < 2e-16\norigin_pulogadung                     3.653e+00  8.834e-03  413.557  < 2e-16\norigin_sawah besar                    3.093e+00  1.021e-02  303.006  < 2e-16\norigin_senen                          3.155e+00  9.471e-03  333.156  < 2e-16\norigin_setiabudi                      4.014e+00  7.444e-03  539.247  < 2e-16\norigin_taman sari                     3.287e+00  9.774e-03  336.317  < 2e-16\norigin_tambora                        3.075e+00  1.056e-02  291.181  < 2e-16\norigin_tanah abang                    3.915e+00  7.727e-03  506.720  < 2e-16\norigin_tanjung priok                  4.082e+00  7.981e-03  511.440  < 2e-16\norigin_tebet                          3.797e+00  7.843e-03  484.130  < 2e-16\ndestination_Cultural_Attractions      1.877e-01  1.952e-03   96.152  < 2e-16\ndestination_Essentials                1.724e-01  2.492e-03   69.189  < 2e-16\ndestination_Facilities_Services       1.347e-01  2.686e-03   50.144  < 2e-16\ndestination_Offices_Business          8.128e-03  1.173e-03    6.929 4.25e-12\ndestination_Others                   -3.867e-03  1.294e-04  -29.889  < 2e-16\ndestination_Restaurants_Food          3.800e-02  2.054e-03   18.503  < 2e-16\ndestination_Shops                    -2.426e-02  2.858e-03   -8.489  < 2e-16\ndestination_Recreation_Entertainment  3.869e-02  1.461e-03   26.481  < 2e-16\ndist                                 -5.746e-05  1.026e-07 -560.082  < 2e-16\n                                        \norigin_cakung                        ***\norigin_cempaka putih                 ***\norigin_cengkareng                    ***\norigin_cilandak                      ***\norigin_cilincing                     ***\norigin_cipayung                      ***\norigin_ciracas                       ***\norigin_danau sunter                     \norigin_danau sunter dll              ***\norigin_duren sawit                   ***\norigin_gambir                        ***\norigin_grogol petamburan             ***\norigin_jagakarsa                     ***\norigin_jatinegara                    ***\norigin_johar baru                    ***\norigin_kalideres                     ***\norigin_kebayoran baru                ***\norigin_kebayoran lama                ***\norigin_kebon jeruk                   ***\norigin_kelapa gading                 ***\norigin_kemayoran                     ***\norigin_kembangan                     ***\norigin_koja                          ***\norigin_kramatjati                    ***\norigin_makasar                       ***\norigin_mampang prapatan              ***\norigin_matraman                      ***\norigin_menteng                       ***\norigin_pademangan                    ***\norigin_pal merah                     ***\norigin_pancoran                      ***\norigin_pasar minggu                  ***\norigin_pasar rebo                    ***\norigin_penjaringan                   ***\norigin_pesanggrahan                  ***\norigin_pulogadung                    ***\norigin_sawah besar                   ***\norigin_senen                         ***\norigin_setiabudi                     ***\norigin_taman sari                    ***\norigin_tambora                       ***\norigin_tanah abang                   ***\norigin_tanjung priok                 ***\norigin_tebet                         ***\ndestination_Cultural_Attractions     ***\ndestination_Essentials               ***\ndestination_Facilities_Services      ***\ndestination_Offices_Business         ***\ndestination_Others                   ***\ndestination_Restaurants_Food         ***\ndestination_Shops                    ***\ndestination_Recreation_Entertainment ***\ndist                                 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 11296775  on 27568  degrees of freedom\nResidual deviance:   208095  on 27515  degrees of freedom\n  (13 observations deleted due to missingness)\nAIC: 360638\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\nVILLAGE\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Join village-level data and calculate trip counts\nod_village <- od_village %>% \n  rename(\n    origin = origin_village, \n    destination = destination_village\n  )\n\ntripsVillage <- left_join(od_village, poi_orig_dest_wide_village, by = c(\"origin\", \"destination\")) %>%\n  group_by(origin, destination) %>%\n  mutate(trips_count = n_distinct(trj_id)) %>%  \n  ungroup()\n\n# Step 2: Rename for clarity (optional)\ntripsVillage <- tripsVillage %>%\n  rename(\n    origin_ = origin,\n    destination_ = destination\n  )\n\n# Step 3: Fit the generalized linear model (GLM) for village-level data\norigSIM_village <- glm(\n  trips_count ~ origin_ + destination_Cultural_Attractions + destination_Essentials + \n                destination_Facilities_Services + destination_Offices_Business + \n                destination_Others + destination_Restaurants_Food + \n                destination_Shops + destination_Recreation_Entertainment + \n                dist - 1,  # Include distance and exclude intercept\n  family = poisson(link = \"log\"),  # Poisson regression with log link\n  data = tripsVillage,\n  na.action = na.exclude\n)\n\n# Step 4: Model summary\nsummary(origSIM_village)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = trips_count ~ origin_ + destination_Cultural_Attractions + \n    destination_Essentials + destination_Facilities_Services + \n    destination_Offices_Business + destination_Others + destination_Restaurants_Food + \n    destination_Shops + destination_Recreation_Entertainment + \n    dist - 1, family = poisson(link = \"log\"), data = tripsVillage, \n    na.action = na.exclude)\n\nCoefficients:\n                                       Estimate Std. Error z value Pr(>|z|)    \norigin_ancol                          4.490e-01  3.234e-01   1.388 0.165056    \norigin_balekambang                   -6.023e-01  1.002e+00  -0.601 0.547666    \norigin_bali mester                    7.396e-01  2.250e-01   3.288 0.001011 ** \norigin_bambu apus                    -2.819e-01  5.780e-01  -0.488 0.625826    \norigin_bangka                         8.046e-01  2.201e-01   3.656 0.000256 ***\norigin_batu ampar                     1.449e+00  1.031e-01  14.044  < 2e-16 ***\norigin_bendungan hilir                6.617e-01  1.473e-01   4.492 7.06e-06 ***\norigin_bidara cina                    3.603e-01  2.930e-01   1.230 0.218722    \norigin_bintaro                        7.991e-01  2.294e-01   3.483 0.000495 ***\norigin_bukit duri                     4.802e-01  2.433e-01   1.974 0.048373 *  \norigin_bungur                        -5.042e-01  1.002e+00  -0.503 0.614861    \norigin_cakung barat                   2.646e-01  2.392e-01   1.106 0.268695    \norigin_cakung timur                   1.611e+00  7.984e-02  20.183  < 2e-16 ***\norigin_cawang                         6.750e-01  1.969e-01   3.428 0.000608 ***\norigin_ceger                          1.502e+00  9.670e-02  15.530  < 2e-16 ***\norigin_cempaka baru                  -2.352e-01  1.001e+00  -0.235 0.814268    \norigin_cempaka putih timur            6.952e-01  3.179e-01   2.187 0.028762 *  \norigin_cengkareng barat               1.733e+00  7.435e-02  23.303  < 2e-16 ***\norigin_cengkareng timur               1.828e+00  7.602e-02  24.048  < 2e-16 ***\norigin_cibubur                        1.140e+00  1.257e-01   9.065  < 2e-16 ***\norigin_cideng                         7.865e-01  1.505e-01   5.225 1.74e-07 ***\norigin_ciganjur                       9.046e-01  1.571e-01   5.759 8.45e-09 ***\norigin_cijantung                      5.503e-01  3.048e-01   1.806 0.070978 .  \norigin_cikini                         1.229e-01  3.402e-01   0.361 0.717988    \norigin_cilandak barat                 1.326e+00  1.030e-01  12.879  < 2e-16 ***\norigin_cilandak timur                 3.842e-01  2.295e-01   1.674 0.094128 .  \norigin_cilangkap                      3.051e-01  2.686e-01   1.136 0.256138    \norigin_cililitan                      1.391e+00  1.365e-01  10.188  < 2e-16 ***\norigin_cilincing                      3.749e-01  2.926e-01   1.281 0.200150    \norigin_cipayung                       1.019e+00  1.958e-01   5.201 1.98e-07 ***\norigin_cipedak                        9.347e-01  1.298e-01   7.204 5.85e-13 ***\norigin_cipete selatan                 1.055e+00  1.312e-01   8.037 9.21e-16 ***\norigin_cipete utara                   1.680e-02  2.229e-01   0.075 0.939896    \norigin_cipinang besar selatan         9.863e-01  1.459e-01   6.758 1.40e-11 ***\norigin_cipinang besar utara           6.067e-01  2.276e-01   2.665 0.007696 ** \norigin_cipinang cempedak              1.623e-01  4.095e-01   0.396 0.691805    \norigin_cipinang melayu                1.851e-01  3.372e-01   0.549 0.583115    \norigin_cipinang muara                 6.756e-01  2.124e-01   3.180 0.001471 ** \norigin_cipulir                        2.334e-01  2.342e-01   0.997 0.318984    \norigin_ciracas                        3.224e-02  3.220e-01   0.100 0.920242    \norigin_dukuh                         -5.855e-02  3.804e-01  -0.154 0.877675    \norigin_duren sawit                    1.034e+00  1.140e-01   9.076  < 2e-16 ***\norigin_duren tiga                     6.248e-01  2.395e-01   2.609 0.009086 ** \norigin_duri kepa                      9.748e-01  1.292e-01   7.546 4.49e-14 ***\norigin_duri kosambi                   1.360e+00  9.028e-02  15.064  < 2e-16 ***\norigin_duri pulo                     -1.139e-02  3.210e-01  -0.035 0.971703    \norigin_duri selatan                  -3.046e-01  1.001e+00  -0.304 0.760890    \norigin_duri utara                    -1.489e-01  1.000e+00  -0.149 0.881723    \norigin_gambir                         8.927e-01  1.589e-01   5.620 1.91e-08 ***\norigin_gandaria selatan              -5.923e-01  5.787e-01  -1.023 0.306084    \norigin_gandaria utara                 1.056e-01  1.885e-01   0.560 0.575529    \norigin_gedong                         3.590e-01  3.364e-01   1.067 0.285874    \norigin_gelora                         1.146e+00  1.012e-01  11.328  < 2e-16 ***\norigin_glodok                        -9.006e-01  1.001e+00  -0.899 0.368500    \norigin_gondangdia                     2.230e-01  3.208e-01   0.695 0.487012    \norigin_grogol                         1.250e+00  1.032e-01  12.107  < 2e-16 ***\norigin_grogol selatan                 1.122e+00  1.099e-01  10.209  < 2e-16 ***\norigin_grogol utara                   1.012e+00  1.141e-01   8.866  < 2e-16 ***\norigin_guntur                        -2.545e-01  4.114e-01  -0.619 0.536116    \norigin_gunung                         7.448e-01  1.357e-01   5.488 4.07e-08 ***\norigin_gunung sahari selatan          7.069e-01  2.061e-01   3.431 0.000602 ***\norigin_gunung sahari utara            5.086e-01  3.370e-01   1.509 0.131307    \norigin_halim perdana kusuma           8.003e-01  1.962e-01   4.080 4.51e-05 ***\norigin_jagakarsa                      6.600e-01  1.448e-01   4.557 5.18e-06 ***\norigin_jati                          -4.494e-01  5.802e-01  -0.775 0.438584    \norigin_jati padang                    1.390e+00  9.129e-02  15.222  < 2e-16 ***\norigin_jatinegara                     7.404e-01  1.551e-01   4.775 1.80e-06 ***\norigin_jatinegara kaum               -4.679e-01  5.806e-01  -0.806 0.420285    \norigin_jatipulo                      -6.029e-01  5.796e-01  -1.040 0.298252    \norigin_jelambar                       6.814e-01  1.424e-01   4.786 1.70e-06 ***\norigin_jelambar baru                  8.622e-01  1.395e-01   6.182 6.33e-10 ***\norigin_joglo                          7.033e-01  1.490e-01   4.720 2.36e-06 ***\norigin_kali anyar                    -3.954e-01  1.002e+00  -0.395 0.692997    \norigin_kalibaru                      -9.959e-02  5.063e-01  -0.197 0.844050    \norigin_kalibata                       7.591e-01  1.687e-01   4.499 6.84e-06 ***\norigin_kalideres                      1.468e+00  8.506e-02  17.261  < 2e-16 ***\norigin_kalisari                       3.851e-01  3.060e-01   1.259 0.208116    \norigin_kamal                         -1.445e-01  3.607e-01  -0.401 0.688652    \norigin_kamal muara                    1.926e+00  8.841e-02  21.789  < 2e-16 ***\norigin_kampung bali                   2.210e-01  2.119e-01   1.043 0.297097    \norigin_kampung melayu                -2.404e-01  1.000e+00  -0.240 0.810045    \norigin_kapuk                          1.166e+00  1.040e-01  11.212  < 2e-16 ***\norigin_kapuk muara                    1.720e+00  8.239e-02  20.882  < 2e-16 ***\norigin_karang anyar                   1.179e-01  5.024e-01   0.235 0.814445    \norigin_karet                          5.770e-01  1.536e-01   3.757 0.000172 ***\norigin_karet kuningan                 1.255e+00  8.476e-02  14.807  < 2e-16 ***\norigin_karet semanggi                 6.515e-02  2.067e-01   0.315 0.752570    \norigin_karet tengsin                  9.092e-01  1.107e-01   8.213  < 2e-16 ***\norigin_kayu putih                     4.912e-01  2.169e-01   2.264 0.023549 *  \norigin_keagungan                     -9.210e-01  1.001e+00  -0.920 0.357776    \norigin_kebagusan                      1.080e+00  1.108e-01   9.747  < 2e-16 ***\norigin_kebayoran lama selatan         1.093e+00  1.136e-01   9.624  < 2e-16 ***\norigin_kebayoran lama utara           1.805e+00  7.335e-02  24.601  < 2e-16 ***\norigin_kebon baru                     7.906e-01  1.954e-01   4.047 5.19e-05 ***\norigin_kebon bawang                   2.425e-01  2.438e-01   0.994 0.319992    \norigin_kebon jeruk                    9.897e-01  1.346e-01   7.354 1.92e-13 ***\norigin_kebon kacang                   2.043e-01  2.316e-01   0.882 0.377750    \norigin_kebon kelapa                   6.843e-01  2.021e-01   3.386 0.000708 ***\norigin_kebon kosong                  -3.111e-01  7.086e-01  -0.439 0.660639    \norigin_kebon manggis                 -3.179e-01  1.002e+00  -0.317 0.750945    \norigin_kebon melati                   1.448e+00  8.003e-02  18.092  < 2e-16 ***\norigin_kebon pala                     9.300e-01  1.887e-01   4.929 8.25e-07 ***\norigin_kebon sirih                    3.231e-01  2.254e-01   1.433 0.151842    \norigin_kedaung kali angke             6.564e-01  1.650e-01   3.979 6.92e-05 ***\norigin_kedoya selatan                 9.763e-01  1.285e-01   7.601 2.95e-14 ***\norigin_kedoya utara                   8.727e-01  1.373e-01   6.357 2.06e-10 ***\norigin_kelapa dua                     3.197e-01  2.391e-01   1.337 0.181304    \norigin_kelapa dua wetan               1.072e+00  1.418e-01   7.560 4.03e-14 ***\norigin_kelapa gading barat            2.796e+00  4.930e-02  56.719  < 2e-16 ***\norigin_kelapa gading timur            1.543e+00  9.602e-02  16.067  < 2e-16 ***\norigin_kemanggisan                    1.306e+00  1.111e-01  11.752  < 2e-16 ***\norigin_kemayoran                     -2.938e-01  1.001e+00  -0.294 0.769128    \norigin_kembangan selatan              1.187e+00  9.611e-02  12.349  < 2e-16 ***\norigin_kembangan utara                5.718e-01  1.784e-01   3.205 0.001349 ** \norigin_kenari                         3.834e-01  3.192e-01   1.201 0.229685    \norigin_klender                        8.692e-01  1.485e-01   5.852 4.86e-09 ***\norigin_koja                          -1.643e-01  1.001e+00  -0.164 0.869608    \norigin_kota bambu selatan             1.872e-02  3.370e-01   0.056 0.955700    \norigin_kota bambu utara              -1.970e-01  4.111e-01  -0.479 0.631780    \norigin_kramat pela                    3.417e-01  1.772e-01   1.929 0.053779 .  \norigin_kramatjati                     3.970e-01  2.785e-01   1.425 0.154058    \norigin_krukut                         7.415e-04  3.056e-01   0.002 0.998064    \norigin_kuningan barat                -2.540e-01  1.000e+00  -0.254 0.799547    \norigin_kuningan timur                 1.237e+00  8.545e-02  14.474  < 2e-16 ***\norigin_lagoa                         -1.282e-01  1.000e+00  -0.128 0.898050    \norigin_lebak bulus                    1.398e+00  1.019e-01  13.719  < 2e-16 ***\norigin_lenteng agung                  9.907e-01  1.180e-01   8.397  < 2e-16 ***\norigin_lubang buaya                   3.268e-01  3.347e-01   0.976 0.328952    \norigin_makasar                        1.412e-02  3.802e-01   0.037 0.970372    \norigin_malaka jaya                   -4.765e-01  5.792e-01  -0.823 0.410715    \norigin_malaka sari                    3.823e-01  2.400e-01   1.593 0.111132    \norigin_mangga dua selatan             8.056e-01  1.983e-01   4.063 4.85e-05 ***\norigin_manggarai                      2.620e-01  2.731e-01   0.960 0.337222    \norigin_manggarai selatan             -4.756e-01  5.793e-01  -0.821 0.411616    \norigin_maphar                        -4.544e-01  1.001e+00  -0.454 0.649940    \norigin_marunda                        8.886e-01  1.850e-01   4.803 1.56e-06 ***\norigin_melawai                        4.493e-01  1.871e-01   2.402 0.016317 *  \norigin_menteng                       -2.773e-01  3.394e-01  -0.817 0.413904    \norigin_menteng atas                   1.620e-01  1.994e-01   0.813 0.416390    \norigin_menteng dalam                  1.216e+00  1.071e-01  11.358  < 2e-16 ***\norigin_meruya selatan                 5.065e-01  2.295e-01   2.207 0.027279 *  \norigin_meruya utara                   1.269e+00  9.532e-02  13.313  < 2e-16 ***\norigin_munjul                         6.230e-01  3.023e-01   2.061 0.039314 *  \norigin_pademangan barat               7.027e-01  1.740e-01   4.038 5.40e-05 ***\norigin_pademangan timur               3.571e-01  1.952e-01   1.829 0.067372 .  \norigin_palmerah                       9.635e-01  1.283e-01   7.510 5.90e-14 ***\norigin_pancoran                      -3.206e-01  7.081e-01  -0.453 0.650700    \norigin_papanggo                      -1.619e-01  4.127e-01  -0.392 0.694775    \norigin_pasar baru                     3.218e-01  3.049e-01   1.055 0.291281    \norigin_pasar manggis                  6.027e-01  1.345e-01   4.482 7.39e-06 ***\norigin_pasar minggu                   4.543e-01  2.079e-01   2.185 0.028854 *  \norigin_paseban                       -4.924e-01  5.788e-01  -0.851 0.394923    \norigin_pegadungan                     1.039e+00  1.336e-01   7.777 7.42e-15 ***\norigin_pegangsaan dua                 1.674e+00  8.568e-02  19.532  < 2e-16 ***\norigin_pejagalan                      1.057e+00  1.029e-01  10.273  < 2e-16 ***\norigin_pejaten barat                  4.743e-01  1.876e-01   2.528 0.011469 *  \norigin_pejaten timur                  1.180e+00  9.511e-02  12.408  < 2e-16 ***\norigin_pekayon                        8.788e-01  2.581e-01   3.405 0.000662 ***\norigin_pekojan                       -3.612e-01  1.001e+00  -0.361 0.718122    \norigin_pela mampang                   6.431e-01  2.205e-01   2.916 0.003541 ** \norigin_pengadegan                    -2.557e-02  4.494e-01  -0.057 0.954634    \norigin_penggilingan                   7.823e-01  1.495e-01   5.234 1.66e-07 ***\norigin_penjaringan                    1.195e+00  9.844e-02  12.142  < 2e-16 ***\norigin_pesanggrahan                   1.187e-01  4.495e-01   0.264 0.791757    \norigin_petamburan                    -6.257e-01  5.026e-01  -1.245 0.213125    \norigin_petogogan                     -4.869e-01  3.812e-01  -1.277 0.201436    \norigin_petojo utara                   9.526e-01  1.616e-01   5.894 3.76e-09 ***\norigin_petukangan selatan             4.022e-01  3.216e-01   1.251 0.211021    \norigin_petukangan utara               5.848e-01  2.063e-01   2.835 0.004585 ** \norigin_pinangranti                    1.103e+00  1.862e-01   5.925 3.12e-09 ***\norigin_pinangsia                     -5.394e-01  5.021e-01  -1.074 0.282684    \norigin_pisangan baru                 -2.976e-01  1.002e+00  -0.297 0.766412    \norigin_pisangan timur                -4.031e-01  7.099e-01  -0.568 0.570118    \norigin_pluit                          2.582e+00  6.967e-02  37.066  < 2e-16 ***\norigin_pondok bambu                   1.220e+00  1.099e-01  11.105  < 2e-16 ***\norigin_pondok kelapa                  2.011e+00  7.683e-02  26.170  < 2e-16 ***\norigin_pondok kopi                    3.062e-01  2.621e-01   1.168 0.242825    \norigin_pondok labu                    6.426e-01  1.600e-01   4.018 5.88e-05 ***\norigin_pondok pinang                  2.011e+00  6.760e-02  29.744  < 2e-16 ***\norigin_pondok ranggon                -3.153e-01  5.788e-01  -0.545 0.585943    \norigin_pulo                          -6.482e-01  4.110e-01  -1.577 0.114764    \norigin_pulo gadung                    1.938e-01  2.956e-01   0.656 0.512080    \norigin_pulo gebang                    2.169e+00  6.683e-02  32.464  < 2e-16 ***\norigin_ragunan                        1.303e+00  9.794e-02  13.307  < 2e-16 ***\norigin_rambutan                      -3.388e-02  3.231e-01  -0.105 0.916487    \norigin_rawa badak selatan            -3.058e-01  1.002e+00  -0.305 0.760224    \norigin_rawa badak utara              -3.051e-01  1.002e+00  -0.304 0.760758    \norigin_rawa barat                    -4.702e-01  3.811e-01  -1.234 0.217349    \norigin_rawa buaya                     6.282e-01  2.410e-01   2.607 0.009147 ** \norigin_rawa terate                    4.940e-01  2.701e-01   1.829 0.067401 .  \norigin_rawajati                       1.665e+00  7.780e-02  21.396  < 2e-16 ***\norigin_rawamangun                     2.652e-01  2.414e-01   1.099 0.271964    \norigin_rawasari                       5.303e-01  5.006e-01   1.059 0.289416    \norigin_roa malaka                    -3.052e-01  1.001e+00  -0.305 0.760409    \norigin_rorotan                        6.351e-01  2.101e-01   3.023 0.002507 ** \norigin_selong                         2.261e-01  1.880e-01   1.203 0.229131    \norigin_semanan                        8.507e-01  1.592e-01   5.345 9.05e-08 ***\norigin_semper barat                   9.272e-01  1.557e-01   5.956 2.58e-09 ***\norigin_semper timur                   5.286e-01  5.010e-01   1.055 0.291414    \norigin_senayan                        2.791e-01  1.583e-01   1.763 0.077901 .  \norigin_senen                          4.505e-01  2.717e-01   1.658 0.097349 .  \norigin_serdang                        1.855e-01  3.195e-01   0.580 0.561640    \norigin_setia budi                     2.937e-01  1.737e-01   1.691 0.090768 .  \norigin_setu                           5.901e-01  2.371e-01   2.488 0.012829 *  \norigin_slipi                          1.321e-01  3.574e-01   0.370 0.711599    \norigin_srengseng                      7.435e-01  1.396e-01   5.324 1.01e-07 ***\norigin_srengseng sawah                1.577e+00  8.135e-02  19.382  < 2e-16 ***\norigin_sukabumi selatan              -5.467e-01  7.103e-01  -0.770 0.441467    \norigin_sukabumi utara                -1.712e-01  4.525e-01  -0.378 0.705179    \norigin_sukapura                       1.351e-02  3.808e-01   0.035 0.971703    \norigin_sumur batu                     7.596e-01  1.844e-01   4.120 3.78e-05 ***\norigin_sungai bambu                   5.569e-01  1.880e-01   2.962 0.003057 ** \norigin_sunter agung                   1.973e+00  7.856e-02  25.108  < 2e-16 ***\norigin_sunter jaya                    1.860e+00  7.805e-02  23.827  < 2e-16 ***\norigin_susukan                        1.105e+00  1.386e-01   7.973 1.55e-15 ***\norigin_taman sari                    -4.174e-01  1.001e+00  -0.417 0.676689    \norigin_tambora                        3.998e-01  5.018e-01   0.797 0.425687    \norigin_tanah sereal                   1.055e-01  4.486e-01   0.235 0.814068    \norigin_tangki                        -9.123e-01  1.001e+00  -0.911 0.362305    \norigin_tanjung barat                  1.096e+00  1.415e-01   7.749 9.25e-15 ***\norigin_tanjung duren selatan          7.059e-01  1.484e-01   4.757 1.97e-06 ***\norigin_tanjung duren utara            6.233e-01  1.549e-01   4.024 5.72e-05 ***\norigin_tanjung priok                  6.422e-01  2.063e-01   3.114 0.001847 ** \norigin_tebet barat                    2.018e-01  2.450e-01   0.824 0.410165    \norigin_tebet timur                    1.543e+00  1.041e-01  14.812  < 2e-16 ***\norigin_tegal alur                     6.690e-01  1.921e-01   3.483 0.000496 ***\norigin_tegal parang                  -4.205e-01  7.076e-01  -0.594 0.552378    \norigin_tengah                         1.276e+00  1.218e-01  10.475  < 2e-16 ***\norigin_tomang                         7.634e-01  1.419e-01   5.379 7.48e-08 ***\norigin_tugu selatan                   3.757e-01  3.055e-01   1.230 0.218750    \norigin_tugu utara                     2.313e-01  3.357e-01   0.689 0.490723    \norigin_ujung menteng                  1.298e+00  1.089e-01  11.910  < 2e-16 ***\norigin_ulujami                        2.870e-01  2.419e-01   1.186 0.235488    \norigin_utan kayu selatan             -3.746e-01  1.001e+00  -0.374 0.708289    \norigin_utan panjang                  -3.621e-01  1.001e+00  -0.362 0.717663    \norigin_warakas                        5.178e-01  2.341e-01   2.212 0.026987 *  \norigin_wijaya kusuma                  8.272e-01  1.357e-01   6.096 1.09e-09 ***\ndestination_Cultural_Attractions      4.241e-02  7.408e-03   5.725 1.04e-08 ***\ndestination_Essentials               -2.363e-03  1.873e-02  -0.126 0.899612    \ndestination_Facilities_Services       7.814e-02  1.941e-02   4.025 5.69e-05 ***\ndestination_Offices_Business          9.224e-02  1.284e-02   7.185 6.71e-13 ***\ndestination_Others                    2.798e-02  5.696e-03   4.913 8.99e-07 ***\ndestination_Restaurants_Food          4.377e-02  1.599e-02   2.738 0.006181 ** \ndestination_Shops                    -8.798e-03  1.729e-03  -5.090 3.59e-07 ***\ndestination_Recreation_Entertainment  1.501e-01  2.151e-02   6.974 3.07e-12 ***\ndist                                  7.700e-06  1.878e-06   4.100 4.14e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 53994.7  on 2714  degrees of freedom\nResidual deviance:  2583.6  on 2468  degrees of freedom\nAIC: 12360\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\n## Destination-Constrained Spatial Interaction Model\n\nDISTRICT\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndestSIM_district <- glm(\n  trips_count ~ destination_ + origin_Cultural_Attractions + origin_Essentials + \n                origin_Facilities_Services + origin_Offices_Business + \n                origin_Others + origin_Restaurants_Food + \n                origin_Shops + origin_Recreation_Entertainment + \n                dist - 1,  # No intercept\n  family = poisson(link = \"log\"),\n  data = tripsDistrict,\n  na.action = na.exclude\n)\n\nsummary(destSIM_district)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = trips_count ~ destination_ + origin_Cultural_Attractions + \n    origin_Essentials + origin_Facilities_Services + origin_Offices_Business + \n    origin_Others + origin_Restaurants_Food + origin_Shops + \n    origin_Recreation_Entertainment + dist - 1, family = poisson(link = \"log\"), \n    data = tripsDistrict, na.action = na.exclude)\n\nCoefficients:\n                                  Estimate Std. Error  z value Pr(>|z|)    \ndestination_cakung               4.250e+00  8.558e-03  496.619  < 2e-16 ***\ndestination_cempaka putih        2.666e+00  1.359e-02  196.097  < 2e-16 ***\ndestination_cengkareng           4.245e+00  8.259e-03  514.013  < 2e-16 ***\ndestination_cilandak             4.100e+00  8.811e-03  465.256  < 2e-16 ***\ndestination_cilincing            3.549e+00  1.558e-02  227.835  < 2e-16 ***\ndestination_cipayung             4.008e+00  1.170e-02  342.416  < 2e-16 ***\ndestination_ciracas              3.699e+00  1.255e-02  294.818  < 2e-16 ***\ndestination_danau sunter         8.668e-01  1.282e-01    6.761 1.37e-11 ***\ndestination_danau sunter dll     4.836e-01  1.074e-01    4.502 6.74e-06 ***\ndestination_duren sawit          4.178e+00  9.010e-03  463.768  < 2e-16 ***\ndestination_gambir               3.595e+00  7.958e-03  451.734  < 2e-16 ***\ndestination_grogol petamburan    3.774e+00  8.128e-03  464.336  < 2e-16 ***\ndestination_jagakarsa            4.288e+00  9.396e-03  456.383  < 2e-16 ***\ndestination_jatinegara           3.886e+00  7.974e-03  487.399  < 2e-16 ***\ndestination_johar baru           2.075e+00  2.541e-02   81.675  < 2e-16 ***\ndestination_kalideres            3.748e+00  1.127e-02  332.456  < 2e-16 ***\ndestination_kebayoran baru       3.974e+00  7.851e-03  506.245  < 2e-16 ***\ndestination_kebayoran lama       3.926e+00  8.234e-03  476.833  < 2e-16 ***\ndestination_kebon jeruk          3.768e+00  8.277e-03  455.232  < 2e-16 ***\ndestination_kelapa gading        3.751e+00  9.196e-03  407.857  < 2e-16 ***\ndestination_kemayoran            3.206e+00  9.720e-03  329.846  < 2e-16 ***\ndestination_kembangan            3.807e+00  9.098e-03  418.469  < 2e-16 ***\ndestination_koja                 3.361e+00  1.264e-02  265.898  < 2e-16 ***\ndestination_kramatjati           3.877e+00  9.164e-03  423.034  < 2e-16 ***\ndestination_makasar              3.463e+00  1.202e-02  288.225  < 2e-16 ***\ndestination_mampang prapatan     3.272e+00  9.264e-03  353.218  < 2e-16 ***\ndestination_matraman             2.771e+00  1.265e-02  218.992  < 2e-16 ***\ndestination_menteng              3.379e+00  8.380e-03  403.155  < 2e-16 ***\ndestination_pademangan           3.367e+00  1.018e-02  330.805  < 2e-16 ***\ndestination_pal merah            3.450e+00  8.493e-03  406.214  < 2e-16 ***\ndestination_pancoran             3.562e+00  8.891e-03  400.640  < 2e-16 ***\ndestination_pasar minggu         4.111e+00  8.299e-03  495.354  < 2e-16 ***\ndestination_pasar rebo           3.319e+00  1.391e-02  238.624  < 2e-16 ***\ndestination_penjaringan          4.270e+00  8.502e-03  502.218  < 2e-16 ***\ndestination_pesanggrahan         3.519e+00  1.026e-02  342.962  < 2e-16 ***\ndestination_pulogadung           3.716e+00  8.368e-03  444.050  < 2e-16 ***\ndestination_sawah besar          2.688e+00  1.221e-02  220.092  < 2e-16 ***\ndestination_senen                3.051e+00  9.533e-03  320.040  < 2e-16 ***\ndestination_setiabudi            3.858e+00  7.679e-03  502.442  < 2e-16 ***\ndestination_taman sari           2.945e+00  1.103e-02  267.033  < 2e-16 ***\ndestination_tambora              2.835e+00  1.118e-02  253.618  < 2e-16 ***\ndestination_tanah abang          3.942e+00  7.715e-03  510.945  < 2e-16 ***\ndestination_tanjung priok        3.970e+00  7.910e-03  501.896  < 2e-16 ***\ndestination_tebet                3.654e+00  8.174e-03  446.986  < 2e-16 ***\norigin_Cultural_Attractions      3.700e-02  1.900e-03   19.478  < 2e-16 ***\norigin_Essentials                2.605e-01  2.462e-03  105.810  < 2e-16 ***\norigin_Facilities_Services       9.768e-03  2.643e-03    3.696 0.000219 ***\norigin_Offices_Business          9.268e-02  1.242e-03   74.623  < 2e-16 ***\norigin_Others                   -6.660e-02  1.419e-03  -46.917  < 2e-16 ***\norigin_Restaurants_Food          1.319e-01  2.089e-03   63.137  < 2e-16 ***\norigin_Shops                    -4.359e-02  2.957e-03  -14.743  < 2e-16 ***\norigin_Recreation_Entertainment  4.796e-02  1.470e-03   32.634  < 2e-16 ***\ndist                            -5.895e-05  1.044e-07 -564.777  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 11296775  on 27568  degrees of freedom\nResidual deviance:   218031  on 27515  degrees of freedom\n  (13 observations deleted due to missingness)\nAIC: 370574\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\nVILLAGE\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndestSIM_village <- glm(\n  trips_count ~ destination_ + origin_Cultural_Attractions + origin_Essentials + \n                origin_Facilities_Services + origin_Offices_Business + \n                origin_Others + origin_Restaurants_Food + \n                origin_Shops + origin_Recreation_Entertainment + \n                dist - 1, \n  family = poisson(link = \"log\"), \n  data = tripsVillage,\n  na.action = na.exclude\n)\n\n# Step 4: Model summary\nsummary(destSIM_village)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = trips_count ~ destination_ + origin_Cultural_Attractions + \n    origin_Essentials + origin_Facilities_Services + origin_Offices_Business + \n    origin_Others + origin_Restaurants_Food + origin_Shops + \n    origin_Recreation_Entertainment + dist - 1, family = poisson(link = \"log\"), \n    data = tripsVillage, na.action = na.exclude)\n\nCoefficients:\n                                     Estimate Std. Error z value Pr(>|z|)    \ndestination_ancol                   1.176e+00  1.242e-01   9.469  < 2e-16 ***\ndestination_angke                   1.313e-01  4.095e-01   0.321 0.748452    \ndestination_balekambang             5.205e-01  3.549e-01   1.467 0.142463    \ndestination_bali mester            -4.256e-01  5.027e-01  -0.846 0.397275    \ndestination_bambu apus             -3.530e-01  5.008e-01  -0.705 0.480954    \ndestination_bangka                 -4.271e-01  1.001e+00  -0.427 0.669498    \ndestination_baru                    1.238e-01  5.029e-01   0.246 0.805513    \ndestination_batu ampar              1.227e+00  1.308e-01   9.383  < 2e-16 ***\ndestination_bendungan hilir         6.874e-01  1.051e-01   6.540 6.17e-11 ***\ndestination_bidara cina             2.194e-01  2.827e-01   0.776 0.437572    \ndestination_bintaro                 4.798e-01  1.697e-01   2.827 0.004692 ** \ndestination_bukit duri             -2.105e-01  3.075e-01  -0.685 0.493659    \ndestination_bungur                 -3.506e-01  4.493e-01  -0.780 0.435177    \ndestination_cakung barat            1.496e+00  8.572e-02  17.454  < 2e-16 ***\ndestination_cakung timur            1.934e+00  6.818e-02  28.369  < 2e-16 ***\ndestination_cawang                  1.388e+00  1.127e-01  12.309  < 2e-16 ***\ndestination_ceger                   7.962e-01  1.763e-01   4.517 6.27e-06 ***\ndestination_cempaka baru            5.639e-01  2.416e-01   2.335 0.019563 *  \ndestination_cempaka putih barat     8.283e-02  4.486e-01   0.185 0.853512    \ndestination_cengkareng barat        1.004e+00  9.984e-02  10.057  < 2e-16 ***\ndestination_cengkareng timur        1.293e+00  8.187e-02  15.788  < 2e-16 ***\ndestination_cibubur                 9.733e-01  1.332e-01   7.304 2.79e-13 ***\ndestination_cideng                  4.782e-01  1.445e-01   3.308 0.000938 ***\ndestination_ciganjur                5.498e-01  1.494e-01   3.680 0.000234 ***\ndestination_cijantung               5.210e-03  1.001e+00   0.005 0.995845    \ndestination_cikini                 -8.610e-01  4.119e-01  -2.090 0.036594 *  \ndestination_cikoko                 -6.456e-01  5.783e-01  -1.116 0.264329    \ndestination_cilandak barat          1.110e+00  9.950e-02  11.157  < 2e-16 ***\ndestination_cilandak timur          2.989e-01  1.789e-01   1.671 0.094791 .  \ndestination_cilangkap               1.433e+00  1.128e-01  12.709  < 2e-16 ***\ndestination_cililitan               1.324e+00  1.071e-01  12.357  < 2e-16 ***\ndestination_cilincing               1.633e-03  3.806e-01   0.004 0.996576    \ndestination_cipayung                6.356e-01  2.156e-01   2.949 0.003190 ** \ndestination_cipedak                 6.124e-01  1.729e-01   3.542 0.000398 ***\ndestination_cipete selatan          7.535e-01  1.196e-01   6.301 2.95e-10 ***\ndestination_cipete utara           -7.462e-02  1.540e-01  -0.485 0.628010    \ndestination_cipinang               -3.827e-01  3.820e-01  -1.002 0.316328    \ndestination_cipinang besar selatan  8.319e-01  2.398e-01   3.469 0.000522 ***\ndestination_cipinang besar utara    7.133e-01  2.489e-01   2.866 0.004162 ** \ndestination_cipinang cempedak       9.485e-01  1.827e-01   5.192 2.08e-07 ***\ndestination_cipinang melayu        -3.844e-01  7.086e-01  -0.542 0.587527    \ndestination_cipinang muara          4.621e-01  2.714e-01   1.702 0.088672 .  \ndestination_cipulir                 4.732e-01  1.568e-01   3.018 0.002543 ** \ndestination_ciracas                -2.795e-01  3.819e-01  -0.732 0.464303    \ndestination_dukuh                  -3.442e-01  4.106e-01  -0.838 0.401897    \ndestination_duren sawit             6.693e-01  1.418e-01   4.720 2.36e-06 ***\ndestination_duren tiga              1.141e+00  1.622e-01   7.038 1.95e-12 ***\ndestination_duri kepa               6.852e-01  1.259e-01   5.441 5.30e-08 ***\ndestination_duri kosambi            7.758e-01  1.041e-01   7.455 9.01e-14 ***\ndestination_duri pulo              -3.837e-01  4.509e-01  -0.851 0.394778    \ndestination_duri utara             -6.928e-01  1.002e+00  -0.691 0.489285    \ndestination_gambir                  7.040e-01  1.296e-01   5.431 5.59e-08 ***\ndestination_gandaria selatan       -5.336e-01  4.503e-01  -1.185 0.235946    \ndestination_gandaria utara         -4.377e-01  2.807e-01  -1.559 0.118928    \ndestination_gedong                  9.933e-01  2.034e-01   4.884 1.04e-06 ***\ndestination_gelora                  1.092e+00  7.441e-02  14.673  < 2e-16 ***\ndestination_glodok                 -1.309e+00  1.001e+00  -1.307 0.191094    \ndestination_gondangdia             -5.818e-01  2.840e-01  -2.049 0.040497 *  \ndestination_grogol                 -4.316e-01  2.729e-01  -1.582 0.113739    \ndestination_grogol selatan          1.240e+00  8.978e-02  13.813  < 2e-16 ***\ndestination_grogol utara            1.084e+00  9.584e-02  11.313  < 2e-16 ***\ndestination_guntur                 -6.110e-01  2.748e-01  -2.223 0.026196 *  \ndestination_gunung                 -3.660e-01  2.337e-01  -1.566 0.117255    \ndestination_gunung sahari selatan   8.451e-01  1.895e-01   4.460 8.18e-06 ***\ndestination_gunung sahari utara    -8.551e-01  7.085e-01  -1.207 0.227476    \ndestination_halim perdana kusuma    5.551e-02  3.795e-01   0.146 0.883718    \ndestination_harapan mulia          -4.311e-01  5.794e-01  -0.744 0.456897    \ndestination_jagakarsa               1.146e+00  9.562e-02  11.987  < 2e-16 ***\ndestination_jati                   -2.847e-01  4.117e-01  -0.691 0.489301    \ndestination_jati padang             9.218e-01  1.100e-01   8.378  < 2e-16 ***\ndestination_jatinegara              8.818e-01  1.781e-01   4.952 7.36e-07 ***\ndestination_jatinegara kaum        -3.582e-01  5.042e-01  -0.710 0.477406    \ndestination_jatipulo               -1.035e+00  7.093e-01  -1.460 0.144388    \ndestination_jelambar               -1.596e-01  1.959e-01  -0.815 0.415143    \ndestination_jelambar baru           7.403e-02  1.734e-01   0.427 0.669495    \ndestination_jembatan besi          -6.762e-01  1.002e+00  -0.675 0.499644    \ndestination_jembatan lima          -4.785e-01  1.001e+00  -0.478 0.632535    \ndestination_joglo                   6.551e-01  1.122e-01   5.838 5.29e-09 ***\ndestination_kalibaru               -2.517e-01  5.056e-01  -0.498 0.618613    \ndestination_kalibata                5.102e-01  2.318e-01   2.201 0.027733 *  \ndestination_kalideres               8.903e-01  1.142e-01   7.793 6.56e-15 ***\ndestination_kalisari               -5.197e-01  7.091e-01  -0.733 0.463638    \ndestination_kamal                   5.069e-01  1.602e-01   3.165 0.001553 ** \ndestination_kamal muara             1.440e+00  8.606e-02  16.732  < 2e-16 ***\ndestination_kampung bali           -9.215e-01  4.117e-01  -2.238 0.025195 *  \ndestination_kampung melayu         -7.163e-02  4.108e-01  -0.174 0.861583    \ndestination_kapuk                   5.505e-01  1.181e-01   4.660 3.16e-06 ***\ndestination_kapuk muara             1.488e+00  7.284e-02  20.424  < 2e-16 ***\ndestination_karang anyar           -8.502e-01  7.085e-01  -1.200 0.230112    \ndestination_karet                  -1.627e+00  7.098e-01  -2.292 0.021897 *  \ndestination_karet kuningan          5.167e-01  1.140e-01   4.531 5.88e-06 ***\ndestination_karet semanggi         -1.878e-01  1.617e-01  -1.161 0.245523    \ndestination_karet tengsin           6.610e-01  1.069e-01   6.184 6.26e-10 ***\ndestination_kayu putih             -4.527e-01  3.815e-01  -1.187 0.235391    \ndestination_keagungan              -1.320e+00  1.001e+00  -1.319 0.187195    \ndestination_kebagusan               8.904e-01  1.048e-01   8.499  < 2e-16 ***\ndestination_kebayoran lama selatan  9.632e-01  1.044e-01   9.230  < 2e-16 ***\ndestination_kebayoran lama utara    1.245e+00  9.527e-02  13.073  < 2e-16 ***\ndestination_kebon baru             -9.604e-02  2.248e-01  -0.427 0.669246    \ndestination_kebon bawang            1.648e+00  8.894e-02  18.527  < 2e-16 ***\ndestination_kebon jeruk             8.239e-01  1.028e-01   8.016 1.09e-15 ***\ndestination_kebon kacang           -1.138e+00  4.496e-01  -2.530 0.011395 *  \ndestination_kebon kelapa            2.371e-01  2.230e-01   1.063 0.287597    \ndestination_kebon kosong            1.794e-01  3.571e-01   0.502 0.615400    \ndestination_kebon melati           -7.825e-03  1.960e-01  -0.040 0.968147    \ndestination_kebon pala             -1.644e-01  3.807e-01  -0.432 0.665883    \ndestination_kebon sirih            -9.090e-01  1.002e+00  -0.908 0.364120    \ndestination_kedaung kali angke      1.250e+00  7.782e-02  16.060  < 2e-16 ***\ndestination_kedoya selatan         -5.742e-01  2.929e-01  -1.961 0.049937 *  \ndestination_kedoya utara            3.929e-01  1.409e-01   2.789 0.005295 ** \ndestination_kelapa dua             -1.058e+00  1.003e+00  -1.055 0.291316    \ndestination_kelapa dua wetan        9.829e-01  1.272e-01   7.726 1.11e-14 ***\ndestination_kelapa gading barat     1.916e+00  6.634e-02  28.877  < 2e-16 ***\ndestination_kelapa gading timur     1.630e+00  6.472e-02  25.191  < 2e-16 ***\ndestination_kemanggisan             4.616e-01  1.557e-01   2.965 0.003022 ** \ndestination_kemayoran              -1.423e-01  3.813e-01  -0.373 0.708983    \ndestination_kembangan selatan       8.934e-01  9.775e-02   9.140  < 2e-16 ***\ndestination_kembangan utara        -4.059e-01  2.928e-01  -1.386 0.165738    \ndestination_kenari                 -7.624e-01  1.002e+00  -0.761 0.446640    \ndestination_klender                 5.239e-01  1.684e-01   3.112 0.001857 ** \ndestination_koja                    6.876e-01  2.810e-01   2.447 0.014414 *  \ndestination_kota bambu selatan      2.461e-01  2.077e-01   1.185 0.236089    \ndestination_kota bambu utara       -1.009e+00  1.001e+00  -1.008 0.313565    \ndestination_kramat                 -9.351e-01  1.001e+00  -0.934 0.350180    \ndestination_kramat pela            -8.020e-01  3.188e-01  -2.516 0.011876 *  \ndestination_kramatjati              4.836e-01  2.268e-01   2.132 0.032984 *  \ndestination_krukut                 -1.332e+00  1.001e+00  -1.331 0.183278    \ndestination_kuningan barat          3.791e-01  2.219e-01   1.709 0.087507 .  \ndestination_kuningan timur          4.134e-01  1.004e-01   4.117 3.84e-05 ***\ndestination_kwitang                -7.826e-01  1.002e+00  -0.781 0.434732    \ndestination_lebak bulus             1.274e-01  2.277e-01   0.560 0.575705    \ndestination_lenteng agung           1.340e+00  8.173e-02  16.395  < 2e-16 ***\ndestination_lubang buaya            2.528e-01  3.344e-01   0.756 0.449702    \ndestination_makasar                 7.522e-01  1.680e-01   4.477 7.58e-06 ***\ndestination_malaka jaya             8.606e-02  4.490e-01   0.192 0.847997    \ndestination_malaka sari            -6.354e-01  7.083e-01  -0.897 0.369663    \ndestination_mampang prapatan       -3.326e-01  4.099e-01  -0.811 0.417112    \ndestination_mangga besar           -6.542e-01  1.001e+00  -0.654 0.513321    \ndestination_mangga dua selatan      1.385e-01  3.373e-01   0.410 0.681455    \ndestination_manggarai              -1.028e+00  7.100e-01  -1.448 0.147736    \ndestination_manggarai selatan      -1.040e+00  7.097e-01  -1.466 0.142611    \ndestination_maphar                 -1.050e+00  7.083e-01  -1.482 0.138262    \ndestination_marunda                 8.299e-01  2.134e-01   3.888 0.000101 ***\ndestination_melawai                -2.375e-01  3.049e-01  -0.779 0.435871    \ndestination_menteng                -2.829e-01  2.101e-01  -1.347 0.178072    \ndestination_menteng atas           -2.889e-01  1.879e-01  -1.538 0.124141    \ndestination_menteng dalam           1.158e+00  8.998e-02  12.874  < 2e-16 ***\ndestination_meruya selatan          2.789e-01  1.719e-01   1.623 0.104683    \ndestination_meruya utara            7.880e-01  1.114e-01   7.070 1.55e-12 ***\ndestination_pademangan barat        4.106e-01  2.504e-01   1.640 0.101035    \ndestination_pademangan timur       -2.417e-01  2.461e-01  -0.982 0.326155    \ndestination_palmerah                8.960e-01  1.121e-01   7.991 1.33e-15 ***\ndestination_pancoran                1.670e+00  7.637e-02  21.869  < 2e-16 ***\ndestination_papanggo                3.866e-01  2.004e-01   1.929 0.053770 .  \ndestination_pasar baru              6.837e-01  1.683e-01   4.062 4.87e-05 ***\ndestination_pasar manggis           3.440e-01  1.047e-01   3.285 0.001020 ** \ndestination_pasar minggu            6.101e-01  1.208e-01   5.049 4.43e-07 ***\ndestination_paseban                 9.190e-02  3.194e-01   0.288 0.773558    \ndestination_pegadungan              1.289e+00  1.035e-01  12.453  < 2e-16 ***\ndestination_pegangsaan             -2.121e-01  5.031e-01  -0.422 0.673351    \ndestination_pegangsaan dua          1.603e+00  6.799e-02  23.585  < 2e-16 ***\ndestination_pejagalan               9.163e-01  8.259e-02  11.095  < 2e-16 ***\ndestination_pejaten barat           5.528e-01  1.411e-01   3.919 8.91e-05 ***\ndestination_pejaten timur           3.193e-02  2.395e-01   0.133 0.893907    \ndestination_pekayon                 3.990e-01  2.728e-01   1.463 0.143555    \ndestination_pela mampang           -2.434e-01  1.000e+00  -0.243 0.807753    \ndestination_pengadegan              1.233e-01  3.556e-01   0.347 0.728685    \ndestination_penggilingan            4.304e-01  1.833e-01   2.348 0.018875 *  \ndestination_penjaringan             1.455e+00  7.220e-02  20.154  < 2e-16 ***\ndestination_pesanggrahan           -6.845e-02  3.186e-01  -0.215 0.829904    \ndestination_petamburan             -1.907e-01  1.911e-01  -0.998 0.318389    \ndestination_petogogan              -5.632e-02  1.888e-01  -0.298 0.765478    \ndestination_petojo selatan         -4.092e-01  3.822e-01  -1.071 0.284358    \ndestination_petojo utara           -2.070e-01  3.572e-01  -0.580 0.562162    \ndestination_petukangan selatan      3.623e-01  2.232e-01   1.623 0.104516    \ndestination_petukangan utara        6.962e-01  5.010e-01   1.390 0.164678    \ndestination_pinangranti             9.914e-01  1.491e-01   6.648 2.98e-11 ***\ndestination_pinangsia              -3.772e-02  2.911e-01  -0.130 0.896922    \ndestination_pisangan timur          6.454e-02  2.727e-01   0.237 0.812926    \ndestination_pluit                   1.725e+00  6.942e-02  24.849  < 2e-16 ***\ndestination_pondok bambu            1.545e+00  7.736e-02  19.970  < 2e-16 ***\ndestination_pondok kelapa           1.282e+00  9.623e-02  13.317  < 2e-16 ***\ndestination_pondok kopi             1.340e-01  2.534e-01   0.529 0.596806    \ndestination_pondok labu             9.179e-01  1.060e-01   8.658  < 2e-16 ***\ndestination_pondok pinang           1.895e+00  6.458e-02  29.351  < 2e-16 ***\ndestination_pondok ranggon          6.824e-01  2.113e-01   3.229 0.001241 ** \ndestination_pulo                    8.280e-02  1.790e-01   0.463 0.643564    \ndestination_pulo gadung            -9.236e-01  7.092e-01  -1.302 0.192833    \ndestination_pulo gebang             1.557e+00  9.489e-02  16.404  < 2e-16 ***\ndestination_ragunan                 1.577e+00  7.851e-02  20.082  < 2e-16 ***\ndestination_rambutan                2.797e-01  2.104e-01   1.329 0.183723    \ndestination_rawa badak selatan      1.954e-01  4.498e-01   0.434 0.663963    \ndestination_rawa badak utara       -2.755e-01  7.085e-01  -0.389 0.697380    \ndestination_rawa barat             -3.442e-01  1.852e-01  -1.859 0.063086 .  \ndestination_rawa buaya              5.130e-01  1.501e-01   3.418 0.000631 ***\ndestination_rawa bunga              8.655e-01  1.952e-01   4.434 9.24e-06 ***\ndestination_rawa terate             1.110e+00  1.145e-01   9.693  < 2e-16 ***\ndestination_rawajati               -5.134e-02  5.019e-01  -0.102 0.918526    \ndestination_rawamangun              3.383e-01  2.235e-01   1.514 0.130085    \ndestination_rawasari                6.934e-01  3.371e-01   2.057 0.039685 *  \ndestination_roa malaka              6.695e-03  5.035e-01   0.013 0.989390    \ndestination_rorotan                 1.053e+00  1.787e-01   5.894 3.77e-09 ***\ndestination_selong                 -4.376e-01  2.463e-01  -1.776 0.075672 .  \ndestination_semanan                 8.461e-01  1.191e-01   7.103 1.22e-12 ***\ndestination_semper barat            4.504e-01  2.361e-01   1.908 0.056412 .  \ndestination_semper timur            5.782e-01  1.994e-01   2.900 0.003734 ** \ndestination_senayan                 3.458e-02  1.382e-01   0.250 0.802382    \ndestination_senen                   1.987e-01  3.212e-01   0.619 0.536022    \ndestination_serdang                 1.080e-01  5.036e-01   0.214 0.830172    \ndestination_setia budi              5.622e-01  9.892e-02   5.684 1.32e-08 ***\ndestination_setu                    3.686e-01  2.252e-01   1.637 0.101677    \ndestination_slipi                   1.575e-01  1.858e-01   0.848 0.396500    \ndestination_srengseng               6.538e-01  1.238e-01   5.282 1.28e-07 ***\ndestination_srengseng sawah         6.828e-01  1.228e-01   5.561 2.68e-08 ***\ndestination_sukabumi selatan       -5.758e-01  4.516e-01  -1.275 0.202326    \ndestination_sukabumi utara          3.282e-01  1.874e-01   1.751 0.079879 .  \ndestination_sukapura                5.584e-01  2.720e-01   2.053 0.040088 *  \ndestination_sumur batu             -2.314e-01  7.085e-01  -0.327 0.744002    \ndestination_sungai bambu            4.774e-01  1.480e-01   3.225 0.001260 ** \ndestination_sunter agung            1.416e+00  8.004e-02  17.695  < 2e-16 ***\ndestination_sunter jaya             1.489e+00  8.105e-02  18.373  < 2e-16 ***\ndestination_susukan                 8.661e-01  1.448e-01   5.981 2.22e-09 ***\ndestination_taman sari             -8.750e-01  1.001e+00  -0.874 0.382072    \ndestination_tanah sereal           -1.013e-01  1.000e+00  -0.101 0.919374    \ndestination_tangki                 -6.690e-01  1.001e+00  -0.668 0.503909    \ndestination_tanjung barat           6.766e-01  1.561e-01   4.334 1.46e-05 ***\ndestination_tanjung duren selatan   3.789e-01  1.606e-01   2.359 0.018333 *  \ndestination_tanjung duren utara     5.757e-01  1.234e-01   4.667 3.06e-06 ***\ndestination_tanjung priok          -1.189e-01  2.184e-01  -0.544 0.586217    \ndestination_tebet barat             8.331e-01  1.185e-01   7.033 2.02e-12 ***\ndestination_tebet timur             4.115e-01  2.004e-01   2.053 0.040060 *  \ndestination_tegal alur              3.376e-01  1.907e-01   1.770 0.076655 .  \ndestination_tegal parang            1.555e-01  2.559e-01   0.608 0.543353    \ndestination_tengah                 -7.050e-02  3.182e-01  -0.222 0.824658    \ndestination_tomang                  9.668e-01  8.433e-02  11.464  < 2e-16 ***\ndestination_tugu selatan           -3.286e-01  7.085e-01  -0.464 0.642791    \ndestination_tugu utara             -4.207e-01  7.081e-01  -0.594 0.552402    \ndestination_ujung menteng          -5.740e-02  3.801e-01  -0.151 0.879948    \ndestination_ulujami                -3.325e-01  4.503e-01  -0.738 0.460321    \ndestination_utan kayu selatan      -5.979e-01  7.080e-01  -0.845 0.398378    \ndestination_utan kayu utara        -4.310e-01  1.002e+00  -0.430 0.666946    \ndestination_warakas                -6.618e-01  3.820e-01  -1.732 0.083222 .  \ndestination_wijaya kusuma          -2.454e-01  2.070e-01  -1.185 0.235833    \norigin_Cultural_Attractions         1.897e-01  1.929e-02   9.837  < 2e-16 ***\norigin_Essentials                   7.136e-02  1.902e-02   3.753 0.000175 ***\norigin_Facilities_Services          5.863e-02  2.136e-02   2.744 0.006062 ** \norigin_Offices_Business             1.664e-01  1.347e-02  12.351  < 2e-16 ***\norigin_Others                       1.188e-01  1.998e-02   5.946 2.74e-09 ***\norigin_Restaurants_Food             1.628e-01  1.629e-02   9.994  < 2e-16 ***\norigin_Shops                       -1.620e-01  1.646e-02  -9.844  < 2e-16 ***\norigin_Recreation_Entertainment     1.059e-01  2.201e-02   4.814 1.48e-06 ***\ndist                                4.403e-06  1.986e-06   2.218 0.026584 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 53994.7  on 2714  degrees of freedom\nResidual deviance:  2928.7  on 2462  degrees of freedom\nAIC: 12717\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\n## Doubly Constrained Spatial Interaction Model\n\nDistrict\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndbcSIM_district <- glm(\n  formula = trips_count ~ origin_Cultural_Attractions + origin_Essentials + \n                origin_Facilities_Services + origin_Offices_Business + \n                origin_Others + origin_Restaurants_Food + \n                origin_Shops + origin_Recreation_Entertainment +  destination_Cultural_Attractions + destination_Essentials + \n                destination_Facilities_Services + destination_Offices_Business + \n                destination_Others + destination_Restaurants_Food + \n                destination_Shops + destination_Recreation_Entertainment + \n                dist - 1, \n              family = poisson(link = \"log\"),\n  data = tripsDistrict,\n  na.action = na.exclude)\n\nsummary(dbcSIM_district)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = trips_count ~ origin_Cultural_Attractions + origin_Essentials + \n    origin_Facilities_Services + origin_Offices_Business + origin_Others + \n    origin_Restaurants_Food + origin_Shops + origin_Recreation_Entertainment + \n    destination_Cultural_Attractions + destination_Essentials + \n    destination_Facilities_Services + destination_Offices_Business + \n    destination_Others + destination_Restaurants_Food + destination_Shops + \n    destination_Recreation_Entertainment + dist - 1, family = poisson(link = \"log\"), \n    data = tripsDistrict, na.action = na.exclude)\n\nCoefficients:\n                                       Estimate Std. Error  z value Pr(>|z|)\norigin_Cultural_Attractions           2.059e-01  1.814e-03  113.542  < 2e-16\norigin_Essentials                     3.053e-01  2.304e-03  132.538  < 2e-16\norigin_Facilities_Services            2.236e-01  2.587e-03   86.429  < 2e-16\norigin_Offices_Business              -1.972e-03  1.182e-03   -1.669  0.09520\norigin_Others                        -3.932e-02  1.427e-03  -27.549  < 2e-16\norigin_Restaurants_Food               1.232e-01  2.121e-03   58.077  < 2e-16\norigin_Shops                          2.300e-03  2.869e-03    0.802  0.42280\norigin_Recreation_Entertainment      -2.151e-02  1.460e-03  -14.728  < 2e-16\ndestination_Cultural_Attractions      3.229e-01  1.856e-03  173.924  < 2e-16\ndestination_Essentials                2.444e-01  2.344e-03  104.231  < 2e-16\ndestination_Facilities_Services       3.851e-01  2.540e-03  151.601  < 2e-16\ndestination_Offices_Business         -9.876e-02  1.110e-03  -88.998  < 2e-16\ndestination_Others                   -2.722e-03  1.283e-04  -21.207  < 2e-16\ndestination_Restaurants_Food          3.042e-03  2.044e-03    1.489  0.13659\ndestination_Shops                    -7.969e-03  2.790e-03   -2.856  0.00428\ndestination_Recreation_Entertainment -2.306e-02  1.457e-03  -15.830  < 2e-16\ndist                                 -4.710e-05  9.456e-08 -498.132  < 2e-16\n                                        \norigin_Cultural_Attractions          ***\norigin_Essentials                    ***\norigin_Facilities_Services           ***\norigin_Offices_Business              .  \norigin_Others                        ***\norigin_Restaurants_Food              ***\norigin_Shops                            \norigin_Recreation_Entertainment      ***\ndestination_Cultural_Attractions     ***\ndestination_Essentials               ***\ndestination_Facilities_Services      ***\ndestination_Offices_Business         ***\ndestination_Others                   ***\ndestination_Restaurants_Food            \ndestination_Shops                    ** \ndestination_Recreation_Entertainment ***\ndist                                 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 11296775  on 27568  degrees of freedom\nResidual deviance:   432984  on 27551  degrees of freedom\n  (13 observations deleted due to missingness)\nAIC: 585455\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\nVILLAGE\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndbcSIM_village <- glm(\n  formula = trips_count ~ origin_Cultural_Attractions + origin_Essentials + \n                origin_Facilities_Services + origin_Offices_Business + \n                origin_Others + origin_Restaurants_Food + \n                origin_Shops + origin_Recreation_Entertainment +  destination_Cultural_Attractions + destination_Essentials + \n                destination_Facilities_Services + destination_Offices_Business + \n                destination_Others + destination_Restaurants_Food + \n                destination_Shops + destination_Recreation_Entertainment + \n                dist - 1, \n              family = poisson(link = \"log\"),\n  data = tripsVillage,\n  na.action = na.exclude)\n\nsummary(dbcSIM_village)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = trips_count ~ origin_Cultural_Attractions + origin_Essentials + \n    origin_Facilities_Services + origin_Offices_Business + origin_Others + \n    origin_Restaurants_Food + origin_Shops + origin_Recreation_Entertainment + \n    destination_Cultural_Attractions + destination_Essentials + \n    destination_Facilities_Services + destination_Offices_Business + \n    destination_Others + destination_Restaurants_Food + destination_Shops + \n    destination_Recreation_Entertainment + dist - 1, family = poisson(link = \"log\"), \n    data = tripsVillage, na.action = na.exclude)\n\nCoefficients:\n                                       Estimate Std. Error z value Pr(>|z|)    \norigin_Cultural_Attractions           3.236e-01  1.426e-02  22.690  < 2e-16 ***\norigin_Essentials                     2.631e-01  1.457e-02  18.060  < 2e-16 ***\norigin_Facilities_Services           -1.250e-03  1.576e-02  -0.079  0.93678    \norigin_Offices_Business               1.794e-01  9.138e-03  19.633  < 2e-16 ***\norigin_Others                         4.830e-02  1.303e-02   3.707  0.00021 ***\norigin_Restaurants_Food               1.380e-01  1.208e-02  11.421  < 2e-16 ***\norigin_Shops                         -2.587e-01  1.293e-02 -20.008  < 2e-16 ***\norigin_Recreation_Entertainment       2.906e-02  1.674e-02   1.736  0.08265 .  \ndestination_Cultural_Attractions      5.184e-02  5.504e-03   9.419  < 2e-16 ***\ndestination_Essentials                1.724e-01  1.329e-02  12.975  < 2e-16 ***\ndestination_Facilities_Services       7.399e-03  1.440e-02   0.514  0.60741    \ndestination_Offices_Business          5.121e-02  9.302e-03   5.505 3.69e-08 ***\ndestination_Others                    8.191e-03  3.274e-03   2.502  0.01234 *  \ndestination_Restaurants_Food          6.378e-02  1.127e-02   5.658 1.53e-08 ***\ndestination_Shops                    -1.085e-02  1.299e-03  -8.354  < 2e-16 ***\ndestination_Recreation_Entertainment  5.652e-02  1.734e-02   3.260  0.00111 ** \ndist                                  3.150e-05  1.216e-06  25.912  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 53994.7  on 2714  degrees of freedom\nResidual deviance:  7668.5  on 2697  degrees of freedom\nAIC: 16987\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntripsDistrict <- tripsDistrict %>%\n  mutate(origin_time_cluster = str_to_title(origin_time_cluster))\n\n# Modify origin_time_cluster in tripsVillage\ntripsVillage <- tripsVillage %>%\n  mutate(origin_time_cluster = str_to_title(origin_time_cluster))\n\nwrite_rds(tripsDistrict, \"data/rds/tripsDistrict.rds\")\nwrite_rds(tripsVillage, \"data/rds/tripsVillage.rds\")\n```\n:::\n\n\n\n\n# Push-Pull Factor Analysis\n\nDistrict\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Extract coefficients for each model\norigin_constrained_coef_district <- coef(origSIM_district)[c(\n  \"destination_Cultural_Attractions\", \"destination_Essentials\", \n  \"destination_Facilities_Services\", \"destination_Offices_Business\", \n  \"destination_Others\", \"destination_Restaurants_Food\", \n  \"destination_Shops\", \"destination_Recreation_Entertainment\"\n)]\n\ndestination_constrained_coef_district <- coef(destSIM_district)[c(\n  \"origin_Cultural_Attractions\", \"origin_Essentials\", \n  \"origin_Facilities_Services\", \"origin_Offices_Business\", \n  \"origin_Others\", \"origin_Restaurants_Food\", \n  \"origin_Shops\", \"origin_Recreation_Entertainment\"\n)]\n\ndoubly_constrained_coef_district <- coef(dbcSIM_district)[c(\n  \"origin_Cultural_Attractions\", \"origin_Essentials\", \n  \"origin_Facilities_Services\", \"origin_Offices_Business\", \n  \"origin_Others\", \"origin_Restaurants_Food\", \n  \"origin_Shops\", \"origin_Recreation_Entertainment\",\n  \"destination_Cultural_Attractions\", \"destination_Essentials\", \n  \"destination_Facilities_Services\", \"destination_Offices_Business\", \n  \"destination_Others\", \"destination_Restaurants_Food\", \n  \"destination_Shops\", \"destination_Recreation_Entertainment\"\n)]\n\n# Step 2: Combine coefficients into a data frame\ncoefficients_district_df <- data.frame(\n  Category = c(\"Cultural_Attractions\", \"Essentials\", \"Facilities_Services\", \n               \"Offices_Business\", \"Others\", \"Restaurants_Food\", \n               \"Shops\", \"Recreation_Entertainment\"),\n  Origin_Constrained = origin_constrained_coef_district,\n  Destination_Constrained = destination_constrained_coef_district,\n  Doubly_Constrained = doubly_constrained_coef_district\n)\n\n# Step 3: Reshape data to long format\ncoefficients_long_district <- coefficients_district_df %>%\n  pivot_longer(\n    cols = -Category, \n    names_to = \"Model\", \n    values_to = \"Coefficient\"\n  )\n\n# Step 4: Filter data for each model\nori_const_district <- coefficients_long_district %>%\n  filter(Model == \"Origin_Constrained\")\n\ndest_const_district <- coefficients_long_district %>%\n  filter(Model == \"Destination_Constrained\")\n\ndoubly_const_district <- coefficients_long_district %>%\n  filter(Model == \"Doubly_Constrained\")\n\n# Step 5: Define color palette for categories\nnum_categories <- length(unique(coefficients_long_district$Category))\ncategory_colors <- brewer.pal(min(num_categories, 9), \"Pastel1\")\nif (num_categories > 9) {\n  category_colors <- colorRampPalette(brewer.pal(9, \"Pastel1\"))(num_categories)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(coefficients_long_district, \"data/rds/coefficients_long_district.rds\")\ncoefficients_long_district <- read_rds(\"data/rds/coefficients_long_district.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Reorder categories by coefficient for the origin-constrained model\nori_const_district <- coefficients_long_district %>%\n  filter(Model == \"Origin_Constrained\") %>%\n  mutate(Category = fct_reorder(Category, Coefficient, .desc = TRUE))  # Reorder by Coefficient (descending)\n\n# Step 2: Reorder categories by coefficient for the destination-constrained model\ndest_const_district <- coefficients_long_district %>%\n  filter(Model == \"Destination_Constrained\") %>%\n  mutate(Category = fct_reorder(Category, Coefficient, .desc = TRUE))  # Reorder by Coefficient (descending)\n\n# Step 3: Reorder categories by coefficient for the doubly constrained model\ndbc_const_district <- coefficients_long_district %>%\n  filter(Model == \"Doubly_Constrained\") %>%\n  mutate(Category = fct_reorder(Category, Coefficient, .desc = TRUE))  # Reorder by Coefficient (descending)\n\n# Step 4: Plot for Origin-Constrained Model\nplot_origin <- ggplot(ori_const_district, aes(y = Category, x = Coefficient, fill = Coefficient)) +\n  geom_bar(stat = \"identity\") +\n  theme_minimal() +\n  scale_fill_viridis(option = \"D\", direction = -1, guide = \"none\") +  # Use viridis palette\n  labs(\n    title = \"Origin-Constrained Model\",\n    x = \"Coefficient\",\n    y = \"POI Category\"\n  ) +\n  theme(\n    axis.text.y = element_text(angle = 0, hjust = 1),  # Adjust y-axis labels\n    legend.position = \"none\"  # Remove legend\n  ) +\n  scale_x_continuous(position = \"top\", limits = c(-max(abs(ori_const_district$Coefficient)),\n                                                  max(abs(ori_const_district$Coefficient))))  # Center at zero\n\n# Step 6: Plot for Destination-Constrained Model\nplot_destination <- ggplot(dest_const_district, aes(y = Category, x = Coefficient, fill = Coefficient)) +\n  geom_bar(stat = \"identity\") +\n  theme_minimal() +\n  scale_fill_viridis(option = \"D\", direction = -1, guide = \"none\") +  # Use viridis palette\n  labs(\n    title = \"Destination-Constrained Model\",\n    x = \"Coefficient\",\n    y = \"POI Category\"\n  ) +\n  theme(\n    axis.text.y = element_text(angle = 0, hjust = 1),  # Adjust y-axis labels\n    legend.position = \"none\"  # Remove legend\n  ) +\n  scale_x_continuous(position = \"top\", limits = c(-max(abs(dest_const_district$Coefficient)),\n                                                  max(abs(dest_const_district$Coefficient))))  # Center at zero\n\n# Step 7: Plot for Doubly-Constrained Model\nplot_doubly <- ggplot(dbc_const_district, aes(y = Category, x = Coefficient, fill = Coefficient)) +\n  geom_bar(stat = \"identity\", alpha = 0.7) +  # Adjust opacity with alpha (0 = fully transparent, 1 = fully opaque)\n  theme_minimal() +\n  scale_fill_viridis(option = \"D\", direction = -1, guide = \"none\") +  # Use viridis palette\n  labs(\n    title = \"Doubly-Constrained Model\",\n    x = \"Coefficient\",\n    y = \"POI Category\"\n  ) +\n  theme(\n    axis.text.y = element_text(angle = 0, hjust = 1),  # Adjust y-axis labels\n    legend.position = \"none\"  # Remove legend\n  ) +\n  scale_x_continuous(position = \"top\", limits = c(-max(abs(dbc_const_district$Coefficient)),\n                                                  max(abs(dbc_const_district$Coefficient))))  # Center at zero\n\n# Step 8: Arrange all plots in a single column\ngrid.arrange(plot_origin, plot_destination, plot_doubly, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-61-1.png){width=672}\n:::\n:::\n\n\n\n\nVILLAGE\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Extract coefficients for each model at the village level\norigin_constrained_coef_village <- coef(origSIM_village)[c(\n  \"destination_Cultural_Attractions\", \"destination_Essentials\", \n  \"destination_Facilities_Services\", \"destination_Offices_Business\", \n  \"destination_Others\", \"destination_Restaurants_Food\", \n  \"destination_Shops\", \"destination_Recreation_Entertainment\"\n)]\n\ndestination_constrained_coef_village <- coef(destSIM_village)[c(\n  \"origin_Cultural_Attractions\", \"origin_Essentials\", \n  \"origin_Facilities_Services\", \"origin_Offices_Business\", \n  \"origin_Others\", \"origin_Restaurants_Food\", \n  \"origin_Shops\", \"origin_Recreation_Entertainment\"\n)]\n\ndoubly_constrained_coef_village <- coef(dbcSIM_village)[c(\n  \"origin_Cultural_Attractions\", \"origin_Essentials\", \n  \"origin_Facilities_Services\", \"origin_Offices_Business\", \n  \"origin_Others\", \"origin_Restaurants_Food\", \n  \"origin_Shops\", \"origin_Recreation_Entertainment\",\n  \"destination_Cultural_Attractions\", \"destination_Essentials\", \n  \"destination_Facilities_Services\", \"destination_Offices_Business\", \n  \"destination_Others\", \"destination_Restaurants_Food\", \n  \"destination_Shops\", \"destination_Recreation_Entertainment\"\n)]\n\n# Step 2: Combine coefficients into a data frame for village-level data\ncoefficients_village_df <- data.frame(\n  Category = c(\"Cultural_Attractions\", \"Essentials\", \"Facilities_Services\", \n               \"Offices_Business\", \"Others\", \"Restaurants_Food\", \n               \"Shops\", \"Recreation_Entertainment\"),\n  Origin_Constrained = origin_constrained_coef_village,\n  Destination_Constrained = destination_constrained_coef_village,\n  Doubly_Constrained = doubly_constrained_coef_village\n)\n\n# Step 3: Reshape data to long format for visualization\ncoefficients_long_village <- coefficients_village_df %>%\n  pivot_longer(\n    cols = -Category, \n    names_to = \"Model\", \n    values_to = \"Coefficient\"\n  )\n\n# Step 4: Filter data for each model at the village level\nori_const_village <- coefficients_long_village %>%\n  filter(Model == \"Origin_Constrained\")\n\ndest_const_village <- coefficients_long_village %>%\n  filter(Model == \"Destination_Constrained\")\n\ndoubly_const_village <- coefficients_long_village %>%\n  filter(Model == \"Doubly_Constrained\")\n\n# Step 5: Define color palette for categories (optional customization)\nnum_categories_village <- length(unique(coefficients_long_village$Category))\ncategory_colors_village <- brewer.pal(min(num_categories_village, 9), \"Pastel1\")\nif (num_categories_village > 9) {\n  category_colors_village <- colorRampPalette(brewer.pal(9, \"Pastel1\"))(num_categories_village)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(coefficients_long_village, \"data/rds/coefficients_long_village.rds\")\ncoefficients_long_village <- read_rds(\"data/rds/coefficients_long_village.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: Reorder categories by coefficient for the origin-constrained model\nori_const_village <- coefficients_long_village %>%\n  filter(Model == \"Origin_Constrained\") %>%\n  mutate(Category = fct_reorder(Category, Coefficient, .desc = TRUE))  # Reorder by Coefficient (descending)\n\n# Step 2: Reorder categories by coefficient for the destination-constrained model\ndest_const_village <- coefficients_long_village %>%\n  filter(Model == \"Destination_Constrained\") %>%\n  mutate(Category = fct_reorder(Category, Coefficient, .desc = TRUE))  # Reorder by Coefficient (descending)\n\n# Step 3: Reorder categories by coefficient for the doubly constrained model\ndbc_const_village <- coefficients_long_village %>%\n  filter(Model == \"Doubly_Constrained\") %>%\n  mutate(Category = fct_reorder(Category, Coefficient, .desc = TRUE))  # Reorder by Coefficient (descending)\n\n# Step 4: Plot for Origin-Constrained Model\nplot_origin_village <- ggplot(ori_const_village, aes(y = Category, x = Coefficient, fill = Coefficient)) +\n  geom_bar(stat = \"identity\") +\n  theme_minimal() +\n  scale_fill_viridis(option = \"D\", direction = -1, guide = \"none\") +  # Use viridis palette\n  labs(\n    title = \"Origin-Constrained Model (Village)\",\n    x = \"Coefficient\",\n    y = \"POI Category\"\n  ) +\n  theme(\n    axis.text.y = element_text(angle = 0, hjust = 1),  # Adjust y-axis labels\n    legend.position = \"none\"  # Remove legend\n  ) +\n  scale_x_continuous(position = \"top\", limits = c(-max(abs(ori_const_village$Coefficient)),\n                                                  max(abs(ori_const_village$Coefficient))))  # Center at zero\n\n# Step 6: Plot for Destination-Constrained Model\nplot_destination_village <- ggplot(dest_const_village, aes(y = Category, x = Coefficient, fill = Coefficient)) +\n  geom_bar(stat = \"identity\") +\n  theme_minimal() +\n  scale_fill_viridis(option = \"D\", direction = -1, guide = \"none\") +  # Use viridis palette\n  labs(\n    title = \"Destination-Constrained Model (Village)\",\n    x = \"Coefficient\",\n    y = \"POI Category\"\n  ) +\n  theme(\n    axis.text.y = element_text(angle = 0, hjust = 1),  # Adjust y-axis labels\n    legend.position = \"none\"  # Remove legend\n  ) +\n  scale_x_continuous(position = \"top\", limits = c(-max(abs(dest_const_village$Coefficient)),\n                                                  max(abs(dest_const_village$Coefficient))))  # Center at zero\n\n# Step 7: Plot for Doubly-Constrained Model\nplot_doubly_village <- ggplot(dbc_const_village, aes(y = Category, x = Coefficient, fill = Coefficient)) +\n  geom_bar(stat = \"identity\", alpha = 0.7) +  # Adjust opacity with alpha (0 = fully transparent, 1 = fully opaque)\n  theme_minimal() +\n  scale_fill_viridis(option = \"D\", direction = -1, guide = \"none\") +  # Use viridis palette\n  labs(\n    title = \"Doubly-Constrained Model (Village)\",\n    x = \"Coefficient\",\n    y = \"POI Category\"\n  ) +\n  theme(\n    axis.text.y = element_text(angle = 0, hjust = 1),  # Adjust y-axis labels\n    legend.position = \"none\"  # Remove legend\n  ) +\n  scale_x_continuous(position = \"top\", limits = c(-max(abs(dbc_const_village$Coefficient)),\n                                                  max(abs(dbc_const_village$Coefficient))))  # Center at zero\n\n# Step 8: Arrange all plots in a single column\ngrid.arrange(plot_origin_village, plot_destination_village, plot_doubly_village, ncol = 1)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 3 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_bar()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-64-1.png){width=672}\n:::\n:::\n\n\n\n\n### Additional Visualization for Trip Count by Time of Day (Heatmap)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(tripsDistrict$origin_time_cluster)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Afternoon Lull\" \"Morning Lull\"   \"Morning Peak\"   \"Afternoon Peak\"\n[5] \"Midnight Peak\"  \"Midnight Lull\"  \"Evening Lull\"   \"Evening Peak\"  \n```\n\n\n:::\n\n```{.r .cell-code}\nunique(tripsVillage$origin_time_cluster)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Morning Peak\"   \"Afternoon Peak\" \"Afternoon Lull\" \"Midnight Lull\" \n[5] \"Morning Lull\"   \"Midnight Peak\"  \"Evening Peak\"   \"Evening Lull\"  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntripsDistrict$origin_time_cluster <- factor(\n  tripsDistrict$origin_time_cluster,\n  levels = c(\"Midnight Peak\", \"Midnight Lull\", \n             \"Morning Peak\", \"Morning Lull\", \n             \"Afternoon Peak\", \"Afternoon Lull\", \n             \"Evening Peak\", \"Evening Lull\"),\n  labels = c(\"midnight peak\", \"midnight lull\", \n             \"morning peak\", \"morning lull\", \n             \"afternoon peak\", \"afternoon lull\", \n             \"evening peak\", \"evening lull\")\n)\n\n\nggplot(tripsDistrict, aes(x = origin_time_cluster, y = origin_, fill = trips_count)) +\n  geom_tile(color = \"white\") +  \n  scale_fill_gradient(low = \"white\", high = \"black\", name = \"Trip Count\") +  \n  scale_x_discrete(position = \"top\") +  \n  labs(\n    title = \"Heatmap of Trips Throughout the Time of Day\",\n    x = \"Time Cluster\",\n    y = \"Destination District\"\n  ) +\n  theme_void() +  \n  theme(\n    axis.text.x = element_text(angle = 0, hjust = 0.5),  \n    axis.text.y = element_text(margin = margin(r = 5)), \n    plot.title = element_text(hjust = 0.5)  \n  )\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-66-1.png){width=1152}\n:::\n:::\n\n\n\n\nVILLAGE:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ensure `origin_time_cluster` is a factor with correct levels and labels\ntripsVillage$origin_time_cluster <- factor(\n  tripsVillage$origin_time_cluster,\n  levels = c(\"Midnight Peak\", \"Midnight Lull\", \n             \"Morning Peak\", \"Morning Lull\", \n             \"Afternoon Peak\", \"Afternoon Lull\", \n             \"Evening Peak\", \"Evening Lull\"),\n  labels = c(\"midnight peak\", \"midnight lull\", \n             \"morning peak\", \"morning lull\", \n             \"afternoon peak\", \"afternoon lull\", \n             \"evening peak\", \"evening lull\")\n)\n\n# Create the heatmap\nggplot(tripsVillage, aes(x = origin_time_cluster, y = origin_, fill = trips_count)) +\n  geom_tile(color = \"white\") +  # Add white gridlines between tiles\n  scale_fill_gradient(low = \"white\", high = \"black\", name = \"Trip Count\") +  # Customize fill gradient\n  scale_x_discrete(position = \"top\") +  # Place x-axis labels at the top\n  labs(\n    title = \"Heatmap of Trips Throughout the Time of Day (Village Level)\",\n    x = \"Time Cluster\",\n    y = \"Origin Village\"\n  ) +\n  theme_minimal() +  # Use a minimal theme for clarity\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels\n    axis.text.y = element_text(size = 8),  # Adjust y-axis label size\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")  # Center and format title\n  )\n```\n\n::: {.cell-output-display}\n![](project_files/figure-html/unnamed-chunk-67-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "project_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}